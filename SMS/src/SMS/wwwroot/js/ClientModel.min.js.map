{"version":3,"sources":["wwwroot/js/ClientModel.js","/source/wwwroot/js/ClientModel.ts"],"names":["__extends","this","d","b","__","constructor","p","hasOwnProperty","prototype","Object","create","ClientModel","SPerson","ServerModel","Person","SAddress","Address","SAlbum","Album","SCommentList","CommentList","Entity","Id","ko","observable","AlbumId","CommentListId","clientId","ClientIdCounter","DeleteOnServer","ServerApi","Delete","SaveToServer","_this","undefined","Create","ConvertToServerEntity","done","data","savedState","LoadFromServerEntity","Update","serverEntity","_i","_a","GetObservableNames","length","prop","sVal","Array","cVal","idOnly","ClientId","entity","propName","val","arr","_b","val_1","elem","push","CopyTo","SaveState","unwrap","slice","val_2","out","isWriteableObservable","Block","RevertState","ignoreError","val_3","_super","apply","arguments","Images","observableArray","AlbumApi","GetDefault","CreateServerEntity","CommentListApi","PersonApi","LastName","FirstName","FullName","computed","Job","DueTo","AssignedTo","AssignedToId","Title","Content","Done","SuperJob","SuperJobId","Trip","TripId","SubJobs","JobApi","Waypoint","latLng","markerType","Map","call","WaypointNumber","polylines","Latitude","Longitude","Distance","Precessor","RouteDistance","RoutePrecessor","Name","Description","WaypointApi","lat","lng","LatLng","L","subscribe","value","Redraw","Polylines","Popup","content","popup","removeLayer","marker","bindPopup","Show","highlight","setOpacity","IsDummy","$","_icon","addClass","Hide","removeClass","updatePolylines","setLatLng","i","redrawPolyline","GetConnectedWaypoints","ret","line","_c","Waypoints","waypoint","sort","w1","w2","distanceTo","convertFromDummyHandle","splitPolyline","MarkerType","w","wCA","WaypointConnectionApi","Disconnect","Connect","IsInPolyline","polyline","currentPolyline","RemoveFromMap","Dummy","removePolyline","AddToPolyline","DummyHandle","addLatLng","redraw","RemoveFromPolyline","removeFromArray","getLatLngs","RemoveIfHasZeroOrOnePolylines","SetLatLng","CenterOnMap","setView","Harbour","name","map","HarbourApi","Locations","Rating","Website","label","getLabel","updateLabelContent","bindLabel","direction","Start","End","Tacks","TripApi","Street","Zip","Town","Comment","AddressApi","Image","ParentAlbumId","Path","Height","Width","Width2","ImageApi","Tack","StartDate","EndDate","Crew","TackApi","CanRemoveTack","read","mapViewModel","SelectedTrip","tacks","index","indexOf","prevTack","nextTack","deferEvaluation","ComputePlaceholder","moment","format","Location","HarbourId","AddressId","LocationApi","Restaurant","RestaurantApi","Supermarket","SupermarketApi","WaypointDistance","calculaterdWaypoints","calculateRoute","ConnectedWayPoints","ConnectedDistances","wp"],"mappings":"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","file":"wwwroot/js/ClientModel.min.js","sourcesContent":["var __extends = (this && this.__extends) || function (d, b) {\n    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n    function __() { this.constructor = d; }\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n};\nvar ClientModel;\n(function (ClientModel) {\n    var SPerson = ServerModel.Person;\n    var SAddress = ServerModel.Address;\n    var SAlbum = ServerModel.Album;\n    var SCommentList = ServerModel.CommentList;\n    var Entity = (function () {\n        function Entity() {\n            this.Id = ko.observable();\n            this.AlbumId = ko.observable();\n            this.CommentListId = ko.observable();\n            this.Album = ko.observable();\n            this.CommentList = ko.observable();\n            this.clientId = ++Entity.ClientIdCounter;\n        }\n        Entity.prototype.DeleteOnServer = function () {\n            return this.ServerApi.Delete(this.Id());\n        };\n        ;\n        Entity.prototype.SaveToServer = function () {\n            var _this = this;\n            if (this.Id() === undefined)\n                return this.ServerApi.Create(this.ConvertToServerEntity())\n                    .done(function (data) {\n                    _this.savedState = undefined;\n                    _this.LoadFromServerEntity(data);\n                });\n            return this.ServerApi.Update(this.ConvertToServerEntity())\n                .done(function () {\n                _this.savedState = undefined;\n            });\n            ;\n        };\n        Entity.prototype.LoadFromServerEntity = function (serverEntity) {\n            for (var _i = 0, _a = this.GetObservableNames(); _i < _a.length; _i++) {\n                var prop = _a[_i];\n                var sVal = serverEntity[prop];\n                if (sVal !== undefined && sVal !== null && !(sVal instanceof Array)) {\n                    var cVal = this[prop]();\n                    if (cVal instanceof Entity)\n                        cVal.LoadFromServerEntity(sVal);\n                    else\n                        this[prop](sVal);\n                }\n            }\n            return this;\n        };\n        Entity.prototype.ConvertToServerEntity = function (idOnly) {\n            if (idOnly === void 0) { idOnly = false; }\n            var serverEntity = { ClientId: this.clientId };\n            var entity = this;\n            for (var _i = 0, _a = this.GetObservableNames(); _i < _a.length; _i++) {\n                var propName = _a[_i];\n                var prop = entity[propName];\n                var val = prop();\n                if (val !== undefined && !(val instanceof Array)) {\n                    if (val instanceof Array) {\n                        var arr = new Array();\n                        for (var _b = 0, val_1 = val; _b < val_1.length; _b++) {\n                            var elem = val_1[_b];\n                            arr.push(elem.ConvertToServerEntity());\n                        }\n                        serverEntity[propName] = arr;\n                    }\n                    else\n                        serverEntity[propName] = val instanceof Entity ? val.ConvertToServerEntity() : val;\n                }\n            }\n            return serverEntity;\n        };\n        Entity.prototype.CopyTo = function (entity) {\n            entity.Id(this.Id());\n        };\n        Entity.prototype.SaveState = function () {\n            var entity = this;\n            entity.savedState = new Object();\n            for (var _i = 0, _a = this.GetObservableNames(); _i < _a.length; _i++) {\n                var prop = _a[_i];\n                var val = ko.unwrap(entity[prop]);\n                if (val instanceof Array) {\n                    val = val.slice(0);\n                    for (var _b = 0, val_2 = val; _b < val_2.length; _b++) {\n                        var elem = val_2[_b];\n                        if (elem instanceof Entity)\n                            elem.SaveState();\n                    }\n                }\n                else if (val instanceof Entity)\n                    val.SaveState();\n                entity.savedState[prop] = val;\n            }\n        };\n        Entity.prototype.GetObservableNames = function () {\n            var out = new Array();\n            var entity = this;\n            for (var prop in entity)\n                if (entity.hasOwnProperty(prop))\n                    if (ko.isWriteableObservable(entity[prop]) && !entity[prop].Block)\n                        out.push(prop);\n            return out;\n        };\n        Entity.prototype.RevertState = function (ignoreError) {\n            if (ignoreError === void 0) { ignoreError = false; }\n            if (this.savedState === undefined)\n                if (ignoreError)\n                    return;\n                else\n                    throw \"No saved state\";\n            var entity = this;\n            for (var _i = 0, _a = this.GetObservableNames(); _i < _a.length; _i++) {\n                var prop = _a[_i];\n                var val = entity.savedState[prop];\n                //this.savedState[prop] = val;\n                entity[prop](val);\n                if (val instanceof Entity)\n                    val.RevertState();\n                else if (val instanceof Array)\n                    for (var _b = 0, val_3 = val; _b < val_3.length; _b++) {\n                        var elem = val_3[_b];\n                        if (elem instanceof Entity)\n                            elem.RevertState();\n                    }\n            }\n        };\n        Entity.ClientIdCounter = 0;\n        return Entity;\n    }());\n    ClientModel.Entity = Entity;\n    var Album = (function (_super) {\n        __extends(Album, _super);\n        function Album() {\n            _super.apply(this, arguments);\n            this.Images = ko.observableArray();\n            this.ServerApi = ServerApi.AlbumApi.GetDefault();\n        }\n        Album.prototype.CreateServerEntity = function () {\n            return new SAlbum();\n        };\n        return Album;\n    }(Entity));\n    ClientModel.Album = Album;\n    var CommentList = (function (_super) {\n        __extends(CommentList, _super);\n        function CommentList() {\n            _super.apply(this, arguments);\n            this.ServerApi = ServerApi.CommentListApi.GetDefault();\n        }\n        CommentList.prototype.CreateServerEntity = function () {\n            return new SCommentList();\n        };\n        return CommentList;\n    }(Entity));\n    ClientModel.CommentList = CommentList;\n    var Person = (function (_super) {\n        __extends(Person, _super);\n        function Person() {\n            var _this = this;\n            _super.apply(this, arguments);\n            this.ServerApi = ServerApi.PersonApi.GetDefault();\n            this.LastName = ko.observable();\n            this.FirstName = ko.observable();\n            this.FullName = ko.computed(function () { return _this.FirstName() + \" \" + _this.LastName(); });\n        }\n        Person.prototype.CreateServerEntity = function () {\n            return new SPerson();\n        };\n        return Person;\n    }(Entity));\n    ClientModel.Person = Person;\n    var Job = (function (_super) {\n        __extends(Job, _super);\n        function Job() {\n            _super.apply(this, arguments);\n            this.DueTo = ko.observable();\n            this.AssignedTo = ko.observable();\n            this.AssignedToId = ko.observable();\n            this.Title = ko.observable();\n            this.Content = ko.observable();\n            this.Done = ko.observable();\n            this.SuperJob = ko.observable();\n            this.SuperJobId = ko.observable();\n            this.Trip = ko.observable();\n            this.TripId = ko.observable();\n            this.SubJobs = ko.observableArray();\n            this.ServerApi = ServerApi.JobApi.GetDefault();\n        }\n        Job.prototype.CreateServerEntity = function () {\n            return new ServerModel.Job();\n        };\n        return Job;\n    }(Entity));\n    ClientModel.Job = Job;\n    var Waypoint = (function (_super) {\n        __extends(Waypoint, _super);\n        function Waypoint(latLng, markerType, Map) {\n            var _this = this;\n            _super.call(this);\n            this.Map = Map;\n            this.WaypointNumber = ko.observable();\n            this.polylines = new Array();\n            this.Latitude = ko.observable();\n            this.Longitude = ko.observable();\n            this.Distance = ko.observable();\n            this.Precessor = ko.observable();\n            this.RouteDistance = ko.observable();\n            this.RoutePrecessor = ko.observable();\n            this.Name = ko.observable();\n            this.Description = ko.observable();\n            this.ServerApi = ServerApi.WaypointApi.GetDefault();\n            this.Latitude(latLng.lat);\n            this.Longitude(latLng.lng);\n            this.LatLng = new L.LatLng(latLng.lat, latLng.lng);\n            this.Latitude.subscribe(function (value) {\n                if (_this.LatLng.lat !== value) {\n                    _this.LatLng.lat = value;\n                    _this.Redraw();\n                }\n            });\n            this.Longitude.subscribe(function (value) {\n                if (_this.LatLng.lng !== value) {\n                    _this.LatLng.lng = value;\n                    _this.Redraw();\n                }\n            });\n            this.markerType = markerType;\n            this.LatLng.Polylines = new Array();\n            this.LatLng.Waypoint = this;\n            //this.Latitude.subscribe((value) => {\n            //    if (this.LatLng.lat !== value) {\n            //        this.Redraw();\n            //    }\n            //});\n            //this.Longitude.subscribe((value) => {\n            //    if (this.LatLng.lng !== value) {\n            //        this.Redraw();\n            //    }\n            //});\n            this.Precessor.Block = true;\n            this.Distance.Block = true;\n        }\n        Waypoint.prototype.Popup = function (content) {\n            if (this.popup !== undefined) {\n                this.Map.removeLayer(this.popup);\n                this.popup = undefined;\n            }\n            if (content !== undefined) {\n                //this.popup = L.popup();\n                this.marker.bindPopup(content); //.openPopup();\n            }\n        };\n        Waypoint.prototype.Show = function (highlight) {\n            if (highlight === void 0) { highlight = false; }\n            this.marker.setOpacity(this.marker.Waypoint.IsDummy() ? 0.5 : 1);\n            if (highlight)\n                $(this.marker._icon).addClass(\"expose\");\n        };\n        Waypoint.prototype.Hide = function () {\n            this.marker.setOpacity(0.1);\n            $(this.marker._icon).removeClass(\"expose\");\n        };\n        Waypoint.prototype.Redraw = function (updatePolylines) {\n            if (updatePolylines === void 0) { updatePolylines = true; }\n            this.marker.setLatLng(this.LatLng);\n            if (updatePolylines)\n                for (var i = 0; i < this.polylines.length; i++)\n                    redrawPolyline(this.polylines[i]);\n        };\n        Waypoint.prototype.GetConnectedWaypoints = function () {\n            var _this = this;\n            var ret = new Array();\n            for (var _i = 0, _a = this.polylines; _i < _a.length; _i++) {\n                var line = _a[_i];\n                for (var _b = 0, _c = line.Waypoints; _b < _c.length; _b++) {\n                    var waypoint = _c[_b];\n                    if (waypoint !== this)\n                        ret.push(waypoint);\n                }\n            }\n            return ret.sort(function (w1, w2) {\n                return w1.LatLng.distanceTo(_this.LatLng) - w2.LatLng.distanceTo(_this.LatLng);\n            });\n        };\n        Waypoint.prototype.convertFromDummyHandle = function () {\n            this.marker.setOpacity(1);\n            var w1 = this.polylines[0].Waypoints[0];\n            var w2 = this.polylines[0].Waypoints[1];\n            splitPolyline(this.polylines[0]);\n            this.markerType = MarkerType.Waypoint;\n            this.SaveToServer()\n                .done(function (w) {\n                var wCA = ServerApi.WaypointConnectionApi.GetDefault();\n                wCA.Disconnect(w1.Id(), w2.Id());\n                wCA.Connect(w1.Id(), w.Id);\n                wCA.Connect(w2.Id(), w.Id);\n            });\n        };\n        Waypoint.prototype.IsInPolyline = function (polyline) {\n            for (var _i = 0, _a = this.polylines; _i < _a.length; _i++) {\n                var currentPolyline = _a[_i];\n                if (polyline === currentPolyline)\n                    return true;\n            }\n            return false;\n        };\n        Waypoint.prototype.RemoveFromMap = function () {\n            if (this.markerType !== MarkerType.Dummy)\n                for (var _i = 0, _a = this.polylines; _i < _a.length; _i++) {\n                    var polyline = _a[_i];\n                    removePolyline(polyline);\n                }\n            this.Map.removeLayer(this.marker);\n        };\n        Waypoint.prototype.AddToPolyline = function (polyline) {\n            if (this.IsInPolyline(polyline))\n                return false;\n            if (polyline.DummyHandle !== this) {\n                polyline.Waypoints.push(this);\n                polyline.addLatLng(this.LatLng);\n                polyline.redraw();\n            }\n            this.LatLng.Polylines.push(polyline);\n            this.polylines.push(polyline);\n            //ServerApi.WaypointConnectionApi.GetDefault().\n            return true;\n        };\n        Waypoint.prototype.RemoveFromPolyline = function (polyline) {\n            if (!this.IsInPolyline(polyline))\n                return false;\n            removeFromArray(polyline.Waypoints, this);\n            removeFromArray(this.polylines, polyline);\n            removeFromArray(this.LatLng.Polylines, polyline);\n            removeFromArray(polyline.getLatLngs(), this.LatLng);\n            polyline.redraw();\n            return true;\n        };\n        Waypoint.prototype.RemoveIfHasZeroOrOnePolylines = function () {\n            return true;\n        };\n        Waypoint.prototype.SetLatLng = function (latLng, updatePolylines) {\n            if (updatePolylines === void 0) { updatePolylines = true; }\n            this.LatLng.lat = latLng.lat;\n            this.LatLng.lng = latLng.lng;\n            this.Latitude(latLng.lat);\n            this.Longitude(latLng.lng);\n            this.Redraw(updatePolylines);\n        };\n        Waypoint.prototype.CenterOnMap = function () {\n            this.Map.setView(this.LatLng);\n        };\n        Waypoint.prototype.IsDummy = function () {\n            return this.markerType === MarkerType.Dummy;\n        };\n        Waypoint.prototype.CreateServerEntity = function () {\n            return new ServerModel.Waypoint();\n        };\n        return Waypoint;\n    }(Entity));\n    ClientModel.Waypoint = Waypoint;\n    var Harbour = (function (_super) {\n        __extends(Harbour, _super);\n        function Harbour(name, latLng, map) {\n            var _this = this;\n            _super.call(this, latLng, MarkerType.Harbour, map);\n            this.Album = ko.observable(new Album());\n            this.CommentList = ko.observable(new CommentList());\n            this.ServerApi = ServerApi.HarbourApi.GetDefault();\n            this.Locations = ko.observableArray();\n            this.Rating = ko.observable();\n            this.Content = ko.observable();\n            this.Website = ko.observable();\n            this.Name(name);\n            //this.Distance.subscribe((d) => {\n            //    const label = this.marker.getLabel();\n            //    if (d > 0) {\n            //        if (label !== undefined) {\n            //            this.marker.updateLabelContent(d.toString() + \" km\");\n            //        } else {\n            //            this.marker.bindLabel(d.toString() + \" km\",\n            //                <any>{\n            //                    direction: \"auto\"\n            //                });\n            //        }\n            //    } else if (label !== undefined) {\n            //        this.marker.unbindLabel();\n            //    }\n            //});\n            this.Name.subscribe(function (d) {\n                var label = _this.marker.getLabel();\n                if (label !== undefined) {\n                    _this.marker.updateLabelContent(d);\n                }\n                else {\n                    _this.marker.bindLabel(d, {\n                        direction: \"auto\"\n                    });\n                }\n            });\n        }\n        Harbour.prototype.RemoveIfHasZeroOrOnePolylines = function () {\n            return false;\n        };\n        Harbour.prototype.CreateServerEntity = function () {\n            return new ServerModel.Harbour();\n        };\n        return Harbour;\n    }(Waypoint));\n    ClientModel.Harbour = Harbour;\n    var Trip = (function (_super) {\n        __extends(Trip, _super);\n        function Trip() {\n            _super.apply(this, arguments);\n            this.Name = ko.observable();\n            this.Start = ko.observable();\n            this.End = ko.observable();\n            this.Content = ko.observable();\n            this.Tacks = ko.observableArray();\n            this.ServerApi = ServerApi.TripApi.GetDefault();\n        }\n        Trip.prototype.CreateServerEntity = function () {\n            return new ServerModel.Trip();\n        };\n        return Trip;\n    }(Entity));\n    ClientModel.Trip = Trip;\n    var Address = (function (_super) {\n        __extends(Address, _super);\n        function Address() {\n            _super.apply(this, arguments);\n            this.Street = ko.observable();\n            this.Zip = ko.observable();\n            this.Town = ko.observable();\n            this.Comment = ko.observable();\n            this.ServerApi = ServerApi.AddressApi.GetDefault();\n        }\n        Address.prototype.CreateServerEntity = function () {\n            return new SAddress;\n        };\n        return Address;\n    }(Entity));\n    ClientModel.Address = Address;\n    var Image = (function (_super) {\n        __extends(Image, _super);\n        function Image() {\n            _super.apply(this, arguments);\n            this.ParentAlbumId = ko.observable();\n            this.Path = ko.observable();\n            this.Height = ko.observable();\n            this.Width = ko.observable();\n            this.Width2 = ko.observable();\n            this.ServerApi = ServerApi.ImageApi.GetDefault();\n        }\n        Image.prototype.CreateServerEntity = function () {\n            return new ServerModel.Image();\n        };\n        return Image;\n    }(Entity));\n    ClientModel.Image = Image;\n    var Tack = (function (_super) {\n        __extends(Tack, _super);\n        function Tack() {\n            var _this = this;\n            _super.apply(this, arguments);\n            this.StartDate = ko.observable();\n            this.EndDate = ko.observable();\n            this.Start = ko.observable();\n            this.End = ko.observable();\n            this.Waypoints = ko.observableArray();\n            this.Crew = ko.observableArray();\n            this.Distance = ko.observable();\n            this.ServerApi = ServerApi.TackApi.GetDefault();\n            this.CanRemoveTack = ko.computed({\n                read: function () {\n                    if (mapViewModel.SelectedTrip() === undefined)\n                        return false;\n                    var tacks = mapViewModel.SelectedTrip().Tacks;\n                    var index = tacks.indexOf(_this);\n                    var prevTack = tacks()[index - 1];\n                    var nextTack = tacks()[index + 1];\n                    if (prevTack !== undefined)\n                        if (nextTack !== undefined)\n                            return prevTack.Start() !== nextTack.Start();\n                        else\n                            return true;\n                    else\n                        return nextTack !== undefined;\n                },\n                deferEvaluation: true\n            });\n            this.ComputePlaceholder = ko.computed(function () {\n                if (_this.StartDate() !== undefined)\n                    return moment(_this.StartDate()).format(\"L\");\n                return \"\";\n            });\n        }\n        Tack.prototype.CreateServerEntity = function () {\n            return new ServerModel.Tack();\n        };\n        return Tack;\n    }(Entity));\n    ClientModel.Tack = Tack;\n    var Location = (function (_super) {\n        __extends(Location, _super);\n        function Location() {\n            _super.apply(this, arguments);\n            this.HarbourId = ko.observable();\n            this.Website = ko.observable();\n            this.Name = ko.observable();\n            this.Rating = ko.observable();\n            this.Address = ko.observable();\n            this.AddressId = ko.observable();\n            this.ServerApi = ServerApi.LocationApi.GetDefault();\n        }\n        Location.prototype.CreateServerEntity = function () {\n            return new ServerModel.Location();\n        };\n        return Location;\n    }(Entity));\n    ClientModel.Location = Location;\n    var Restaurant = (function (_super) {\n        __extends(Restaurant, _super);\n        function Restaurant() {\n            _super.apply(this, arguments);\n            this.ServerApi = ServerApi.RestaurantApi.GetDefault();\n        }\n        Restaurant.prototype.CreateServerEntity = function () {\n            return new ServerModel.Restaurant();\n        };\n        return Restaurant;\n    }(Location));\n    ClientModel.Restaurant = Restaurant;\n    var Supermarket = (function (_super) {\n        __extends(Supermarket, _super);\n        function Supermarket() {\n            _super.apply(this, arguments);\n            this.ServerApi = ServerApi.SupermarketApi.GetDefault();\n        }\n        Supermarket.prototype.CreateServerEntity = function () {\n            return new ServerModel.Supermarket();\n        };\n        return Supermarket;\n    }(Location));\n    ClientModel.Supermarket = Supermarket;\n    var WaypointDistance = (function () {\n        function WaypointDistance(Precessor, Waypoint, Distance, calculaterdWaypoints, calculateRoute) {\n            this.Precessor = Precessor;\n            this.Waypoint = Waypoint;\n            this.Distance = Distance;\n            this.ConnectedWayPoints = new Array();\n            this.ConnectedDistances = new Array();\n            this.LatLng = Waypoint.LatLng;\n            calculaterdWaypoints.push(Waypoint);\n            for (var _i = 0, _a = Waypoint.GetConnectedWaypoints(); _i < _a.length; _i++) {\n                var wp = _a[_i];\n                if (calculaterdWaypoints.indexOf(wp) === -1)\n                    this.ConnectedWayPoints.push(wp);\n            }\n            if (calculateRoute) {\n                Waypoint.RoutePrecessor(Precessor);\n                Waypoint.RouteDistance(Distance);\n            }\n            else {\n                Waypoint.Precessor(Precessor);\n                Waypoint.Distance(Distance);\n            }\n        }\n        return WaypointDistance;\n    }());\n    ClientModel.WaypointDistance = WaypointDistance;\n})(ClientModel || (ClientModel = {}));\nvar MarkerType;\n(function (MarkerType) {\n    MarkerType[MarkerType[\"Harbour\"] = 0] = \"Harbour\";\n    MarkerType[MarkerType[\"Dummy\"] = 1] = \"Dummy\";\n    MarkerType[MarkerType[\"Waypoint\"] = 2] = \"Waypoint\";\n    MarkerType[MarkerType[\"WeatherStation\"] = 3] = \"WeatherStation\";\n})(MarkerType || (MarkerType = {}));\n\n","\r\n\r\nmodule ClientModel {\r\n\r\n\r\n\r\n    import SEntity = ServerModel.Entity\r\n    import SWaypoint = ServerModel.Waypoint\r\n    import SWaypointConnection = ServerModel.WaypointConnection\r\n    import SHarbour = ServerModel.Harbour\r\n    import SPerson = ServerModel.Person\r\n    import SJob = ServerModel.Job\r\n    import STrip = ServerModel.Trip\r\n    import SAddress = ServerModel.Address\r\n    import SImage = ServerModel.Image\r\n    import SAlbum = ServerModel.Album\r\n    import SWaypointTack = ServerModel.WaypointTack\r\n    import STack = ServerModel.Tack\r\n    import SLocation = ServerModel.Location\r\n    import SRestaurant = ServerModel.Restaurant\r\n    import SSupermarket = ServerModel.Supermarket\r\n    import SComment = ServerModel.Comment;\r\n    import SCommentList = ServerModel.CommentList;\r\n\r\n    export abstract class Entity<T extends ServerModel.Entity> {\r\n\r\n        Id = ko.observable<number>();\r\n        AlbumId = ko.observable<number>();\r\n        CommentListId = ko.observable<number>();\r\n        Album = ko.observable<Album>();\r\n        CommentList = ko.observable<CommentList>();\r\n\r\n\r\n        private static ClientIdCounter = 0;\r\n\r\n        private clientId =++Entity.ClientIdCounter;\r\n\r\n        protected ServerApi: ServerApi.Api<T>;\r\n\r\n        DeleteOnServer(): JQueryPromise<T> {\r\n            return this.ServerApi.Delete(this.Id());\r\n        };\r\n\r\n        SaveToServer(): JQueryPromise<T> {\r\n            if (this.Id() === undefined)\r\n                return this.ServerApi.Create(this.ConvertToServerEntity())\r\n                    .done(data => {\r\n                        this.savedState = undefined;\r\n                        this.LoadFromServerEntity(data);\r\n                    });\r\n            return this.ServerApi.Update(this.ConvertToServerEntity())\r\n                .done(() => {\r\n                    this.savedState = undefined;\r\n                });;\r\n        }\r\n\r\n        LoadFromServerEntity(serverEntity: T): this {\r\n            for (let prop of this.GetObservableNames()) {\r\n                const sVal = serverEntity[prop];\r\n                if (sVal !== undefined && sVal !== null && !(sVal instanceof Array)) {\r\n                    const cVal = this[prop]();\r\n                    if (cVal instanceof Entity)\r\n                        cVal.LoadFromServerEntity(sVal);\r\n                    else\r\n                        this[prop](sVal);\r\n                }\r\n            }\r\n            return this;\r\n        }\r\n\r\n        ConvertToServerEntity(idOnly: boolean = false): T {\r\n            const serverEntity = {ClientId:this.clientId};\r\n            const entity = this;\r\n\r\n            for (let propName of this.GetObservableNames()) {\r\n                const prop = entity[propName];\r\n                const val = prop();\r\n                if (val !== undefined && !(val instanceof Array)) {\r\n                    if (val instanceof Array) {\r\n                        const arr = new Array<T>();\r\n                        for (let elem of val) {\r\n                            arr.push(elem.ConvertToServerEntity());\r\n                        }\r\n                        serverEntity[propName] = arr;\r\n                    }\r\n                    else\r\n                        serverEntity[propName] = val instanceof Entity ? val.ConvertToServerEntity() : val;\r\n                }\r\n            }\r\n            return <any>serverEntity;\r\n        }\r\n\r\n        CopyTo(entity: this) {\r\n            entity.Id(this.Id());\r\n        }\r\n\r\n        abstract CreateServerEntity(): T;\r\n\r\n        private savedState: any;\r\n\r\n        SaveState() {\r\n            const entity = this;\r\n            entity.savedState = new Object();\r\n            for (let prop of this.GetObservableNames()) {\r\n                let val = ko.unwrap(entity[prop]);\r\n                if (val instanceof Array) {\r\n                    val = val.slice(0);\r\n                    for (let elem of val) {\r\n                        if (elem instanceof Entity)\r\n                            elem.SaveState();\r\n                    }\r\n                } else if (val instanceof Entity)\r\n                    val.SaveState();\r\n                entity.savedState[prop] = val;\r\n            }\r\n        }\r\n\r\n        protected GetObservableNames(): string[] {\r\n            const out = new Array<string>();\r\n            const entity = this;\r\n            for (let prop in entity)\r\n                if (entity.hasOwnProperty(prop))\r\n                    if (ko.isWriteableObservable(entity[prop]) && !entity[prop].Block)\r\n                        out.push(prop);\r\n            return out;\r\n        }\r\n\r\n        RevertState(ignoreError: boolean = false) {\r\n            if (this.savedState === undefined)\r\n                if (ignoreError)\r\n                    return;\r\n                else\r\n                    throw \"No saved state\";\r\n            const entity = this;\r\n            for (let prop of this.GetObservableNames()) {\r\n                const val = entity.savedState[prop];\r\n                //this.savedState[prop] = val;\r\n                entity[prop](val);\r\n                if (val instanceof Entity)\r\n                    val.RevertState();\r\n                else if (val instanceof Array)\r\n                    for (let elem of val) {\r\n                        if (elem instanceof Entity)\r\n                            elem.RevertState();\r\n                    }\r\n            }\r\n        }\r\n    }\r\n\r\n    export class Album extends Entity<SAlbum> {\r\n        CreateServerEntity(): SAlbum {\r\n            return new SAlbum();\r\n        }\r\n\r\n        Images = ko.observableArray<Image>();\r\n\r\n\r\n        ServerApi = ServerApi.AlbumApi.GetDefault();\r\n    }\r\n\r\n    export class CommentList extends Entity<SCommentList> {\r\n        CreateServerEntity(): SCommentList {\r\n            return new SCommentList();\r\n        }\r\n\r\n        ServerApi = ServerApi.CommentListApi.GetDefault();\r\n    }\r\n\r\n    export class Person extends Entity<SPerson> {\r\n\r\n        CreateServerEntity(): SPerson {\r\n            return new SPerson();\r\n        }\r\n\r\n        ServerApi = ServerApi.PersonApi.GetDefault();\r\n        LastName = ko.observable<string>();\r\n        FirstName = ko.observable<string>();\r\n        FullName = ko.computed(() => this.FirstName() + \" \" + this.LastName());\r\n        \r\n    }\r\n\r\n    export class Job extends Entity<SJob> {\r\n        DueTo = ko.observable<Date>();\r\n        AssignedTo = ko.observable<Person>();\r\n        AssignedToId = ko.observable<number>();\r\n        Title = ko.observable<String>();\r\n        Content = ko.observable<String>();\r\n        Done = ko.observable<boolean>();\r\n        SuperJob = ko.observable<Job>();\r\n        SuperJobId = ko.observable<number>();\r\n        Trip = ko.observable<Trip>();\r\n        TripId = ko.observable<number>();\r\n        SubJobs = ko.observableArray<Job>();\r\n\r\n\r\n        CreateServerEntity(): ServerModel.Job {\r\n            return new ServerModel.Job();\r\n        }\r\n\r\n        ServerApi = ServerApi.JobApi.GetDefault();\r\n    }\r\n\r\n    export class Waypoint extends Entity<SWaypoint> {\r\n        constructor(latLng: L.LatLng, markerType: MarkerType, protected Map: L.mapbox.Map) {\r\n            super();\r\n            this.Latitude(latLng.lat);\r\n            this.Longitude(latLng.lng);\r\n            this.LatLng = new L.LatLng(latLng.lat, latLng.lng);\r\n            this.Latitude.subscribe((value) => {\r\n                if (this.LatLng.lat !== value) {\r\n                    this.LatLng.lat = value;\r\n                    this.Redraw();\r\n                }\r\n            });\r\n            this.Longitude.subscribe((value) => {\r\n                if (this.LatLng.lng !== value) {\r\n                    this.LatLng.lng = value;\r\n                    this.Redraw();\r\n                }\r\n            });\r\n            this.markerType = markerType;\r\n            this.LatLng.Polylines = new Array();\r\n            this.LatLng.Waypoint = this;\r\n            //this.Latitude.subscribe((value) => {\r\n            //    if (this.LatLng.lat !== value) {\r\n            //        this.Redraw();\r\n            //    }\r\n            //});\r\n            //this.Longitude.subscribe((value) => {\r\n            //    if (this.LatLng.lng !== value) {\r\n            //        this.Redraw();\r\n            //    }\r\n            //});\r\n            this.Precessor.Block = true;\r\n            this.Distance.Block = true;\r\n        }\r\n\r\n        Popup(content: string);\r\n        Popup();\r\n        Popup(content?: string) {\r\n            if (this.popup !== undefined) {\r\n                this.Map.removeLayer(this.popup);\r\n                this.popup = undefined;\r\n            }\r\n            if (content !== undefined) {\r\n                //this.popup = L.popup();\r\n                this.marker.bindPopup(content); //.openPopup();\r\n\r\n\r\n            }\r\n        }\r\n\r\n        Show(highlight: boolean = false): void {\r\n            this.marker.setOpacity(this.marker.Waypoint.IsDummy() ? 0.5 : 1);\r\n            if (highlight)\r\n                $(this.marker._icon).addClass(\"expose\");\r\n        }\r\n\r\n        Hide(): void {\r\n            this.marker.setOpacity(0.1);\r\n            $(this.marker._icon).removeClass(\"expose\");\r\n        }\r\n\r\n        Redraw(updatePolylines = true): void {\r\n            this.marker.setLatLng(this.LatLng);\r\n            if (updatePolylines)\r\n                for (let i = 0; i < this.polylines.length; i++)\r\n                    redrawPolyline(this.polylines[i]);\r\n        }\r\n\r\n        GetConnectedWaypoints(): Waypoint[] {\r\n            const ret = new Array<Waypoint>();\r\n            for (let line of this.polylines) {\r\n                for (let waypoint of line.Waypoints) {\r\n                    if (waypoint !== this)\r\n                        ret.push(waypoint);\r\n                }\r\n            }\r\n            return ret.sort((w1, w2) => {\r\n                return w1.LatLng.distanceTo(this.LatLng) - w2.LatLng.distanceTo(this.LatLng);\r\n            });\r\n        }\r\n\r\n        convertFromDummyHandle() {\r\n            this.marker.setOpacity(1);\r\n            var w1 = this.polylines[0].Waypoints[0];\r\n            var w2 = this.polylines[0].Waypoints[1];\r\n            splitPolyline(this.polylines[0]);\r\n            this.markerType = MarkerType.Waypoint;\r\n            this.SaveToServer()\r\n                .done((w) => {\r\n                    const wCA = ServerApi.WaypointConnectionApi.GetDefault();\r\n                    wCA.Disconnect(w1.Id(), w2.Id());\r\n                    wCA.Connect(w1.Id(), w.Id);\r\n                    wCA.Connect(w2.Id(), w.Id);\r\n                });\r\n        }\r\n\r\n        IsInPolyline(polyline: L.Polyline): boolean {\r\n            for (const currentPolyline of this.polylines) {\r\n                if (polyline === currentPolyline)\r\n                    return true;\r\n            }\r\n            return false;\r\n        }\r\n\r\n        RemoveFromMap() {\r\n            if (this.markerType !== MarkerType.Dummy)\r\n                for (let polyline of this.polylines)\r\n                    removePolyline(polyline);\r\n            this.Map.removeLayer(this.marker);\r\n        }\r\n\r\n        AddToPolyline(polyline: L.Polyline): boolean {\r\n            if (this.IsInPolyline(polyline))\r\n                return false;\r\n            if (polyline.DummyHandle !== this) {\r\n                polyline.Waypoints.push(this);\r\n                polyline.addLatLng(this.LatLng);\r\n                polyline.redraw();\r\n            }\r\n            this.LatLng.Polylines.push(polyline);\r\n            this.polylines.push(polyline);\r\n            //ServerApi.WaypointConnectionApi.GetDefault().\r\n            return true;\r\n        }\r\n\r\n        RemoveFromPolyline(polyline: L.Polyline): boolean {\r\n            if (!this.IsInPolyline(polyline))\r\n                return false;\r\n            removeFromArray(polyline.Waypoints, this);\r\n            removeFromArray(this.polylines, polyline);\r\n            removeFromArray(this.LatLng.Polylines, polyline);\r\n            removeFromArray(polyline.getLatLngs(), this.LatLng);\r\n            polyline.redraw();\r\n            return true;\r\n        }\r\n\r\n        RemoveIfHasZeroOrOnePolylines(): boolean {\r\n            return true;\r\n        }\r\n\r\n        WaypointNumber = ko.observable<number>();\r\n        private polylines = new Array<L.Polyline>();\r\n\r\n\r\n        SetLatLng(latLng: L.LatLng, updatePolylines=true): void {\r\n            this.LatLng.lat = latLng.lat;\r\n            this.LatLng.lng = latLng.lng;\r\n            this.Latitude(latLng.lat);\r\n            this.Longitude(latLng.lng);\r\n            this.Redraw(updatePolylines);\r\n        }\r\n\r\n        CenterOnMap() {\r\n            this.Map.setView(this.LatLng);\r\n        }\r\n\r\n        IsDummy(): boolean {\r\n            return this.markerType === MarkerType.Dummy;\r\n        }\r\n\r\n        Latitude = ko.observable<number>();\r\n        Longitude = ko.observable<number>();\r\n        Distance = ko.observable<number>();\r\n        Precessor = ko.observable<Waypoint>();\r\n        RouteDistance = ko.observable<number>();\r\n        RoutePrecessor = ko.observable<Waypoint>();\r\n        protected popup: L.Popup;\r\n        LatLng: L.LatLng;\r\n        protected markerType: MarkerType;\r\n        marker: L.Marker;\r\n\r\n        Name = ko.observable<string>();\r\n        Description = ko.observable<string>();\r\n\r\n        CreateServerEntity(): ServerModel.Waypoint {\r\n            return new ServerModel.Waypoint();\r\n        }\r\n\r\n        ServerApi = ServerApi.WaypointApi.GetDefault();\r\n    }\r\n\r\n    export class Harbour extends Waypoint {\r\n\r\n        constructor(name: string, latLng: L.LatLng, map: L.mapbox.Map) {\r\n            super(latLng, MarkerType.Harbour, map);\r\n            this.Name(name);\r\n            //this.Distance.subscribe((d) => {\r\n            //    const label = this.marker.getLabel();\r\n            //    if (d > 0) {\r\n            //        if (label !== undefined) {\r\n            //            this.marker.updateLabelContent(d.toString() + \" km\");\r\n            //        } else {\r\n            //            this.marker.bindLabel(d.toString() + \" km\",\r\n            //                <any>{\r\n            //                    direction: \"auto\"\r\n            //                });\r\n            //        }\r\n            //    } else if (label !== undefined) {\r\n            //        this.marker.unbindLabel();\r\n            //    }\r\n            //});\r\n            this.Name.subscribe((d) => {\r\n                const label = this.marker.getLabel();\r\n                if (label !== undefined) {\r\n                    this.marker.updateLabelContent(d);\r\n                } else {\r\n                    this.marker.bindLabel(d,\r\n                        {\r\n                            direction: \"auto\"\r\n                        } as any);\r\n                }\r\n            });\r\n        }\r\n\r\n        Album = ko.observable(new Album());\r\n        CommentList = ko.observable(new CommentList());\r\n\r\n        RemoveIfHasZeroOrOnePolylines(): boolean {\r\n            return false;\r\n        }\r\n\r\n        CreateServerEntity(): ServerModel.Harbour {\r\n            return new ServerModel.Harbour();\r\n        }\r\n\r\n        ServerApi = ServerApi.HarbourApi.GetDefault();\r\n\r\n        Locations = ko.observableArray<Location>();\r\n        Rating = ko.observable<number>();\r\n        Content = ko.observable<string>();\r\n        Website = ko.observable<string>();\r\n    }\r\n\r\n    export class Trip extends Entity<STrip> {\r\n        Name = ko.observable<string>();\r\n        Start = ko.observable<Date>();\r\n        End = ko.observable<Date>();\r\n        Content = ko.observable<string>();\r\n        Tacks = ko.observableArray<Tack>();\r\n\r\n        ServerApi = ServerApi.TripApi.GetDefault();\r\n\r\n        CreateServerEntity(): ServerModel.Trip {\r\n            return new ServerModel.Trip();\r\n        }\r\n    }\r\n\r\n    export class Address extends Entity<SAddress> {\r\n        Street = ko.observable<string>();\r\n        Zip = ko.observable<string>();\r\n        Town = ko.observable<string>();\r\n        Comment = ko.observable<string>();\r\n\r\n        CreateServerEntity(): SAddress {\r\n            return new SAddress;\r\n        }\r\n\r\n        ServerApi = ServerApi.AddressApi.GetDefault();\r\n    }\r\n\r\n    export class Image extends Entity<SImage> {\r\n\r\n        ParentAlbumId = ko.observable<number>();\r\n        Path = ko.observable<string>();\r\n        Height = ko.observable<number>();\r\n        Width = ko.observable<number>();\r\n        Width2 = ko.observable<number>();\r\n\r\n        CreateServerEntity(): ServerModel.Image {\r\n            return new ServerModel.Image();\r\n        }\r\n\r\n        ServerApi = ServerApi.ImageApi.GetDefault();\r\n    }\r\n\r\n    export class Tack extends Entity<STack> {\r\n        StartDate = ko.observable<Date>();\r\n        EndDate = ko.observable<Date>();\r\n        Start = ko.observable<Harbour>();\r\n        End = ko.observable<Harbour>();\r\n        Waypoints = ko.observableArray<ServerModel.WaypointTack>();\r\n        Crew = ko.observableArray<Person>();\r\n        Distance = ko.observable<number>();\r\n\r\n        CreateServerEntity(): ServerModel.Tack {\r\n            return new ServerModel.Tack();\r\n        }\r\n\r\n        ServerApi = ServerApi.TackApi.GetDefault();\r\n\r\n\r\n\r\n        CanRemoveTack = ko.computed({\r\n            read: () => {\r\n                if (mapViewModel.SelectedTrip() === undefined)\r\n                    return false;\r\n                const tacks = mapViewModel.SelectedTrip().Tacks;\r\n                const index = tacks.indexOf(this);\r\n                const prevTack = tacks()[index - 1];\r\n                const nextTack = tacks()[index + 1];\r\n                if (prevTack !== undefined)\r\n                    if (nextTack !== undefined)\r\n                        return prevTack.Start() !== nextTack.Start();\r\n                    else\r\n                        return true;\r\n                else\r\n                    return nextTack !== undefined;\r\n            },\r\n            deferEvaluation: true\r\n        });\r\n\r\n        ComputePlaceholder=ko.computed(():string=> {\r\n            if (this.StartDate() !== undefined)\r\n                return moment(this.StartDate()).format(\"L\");\r\n            return \"\";\r\n        });\r\n\r\n    }\r\n\r\n    export class Location extends Entity<SLocation> {\r\n        HarbourId = ko.observable<number>();\r\n        Website = ko.observable<string>();\r\n        Name = ko.observable<string>();\r\n        Rating = ko.observable<number>();\r\n        Address = ko.observable<Address>();\r\n        AddressId = ko.observable<number>();\r\n\r\n        CreateServerEntity(): ServerModel.Location {\r\n            return new ServerModel.Location();\r\n        }\r\n\r\n        ServerApi = ServerApi.LocationApi.GetDefault();\r\n    }\r\n\r\n    export class Restaurant extends Location {\r\n\r\n        CreateServerEntity(): ServerModel.Restaurant {\r\n            return new ServerModel.Restaurant();\r\n        }\r\n\r\n        ServerApi = ServerApi.RestaurantApi.GetDefault();\r\n    }\r\n\r\n\r\n    export class Supermarket extends Location {\r\n\r\n        CreateServerEntity(): ServerModel.Supermarket {\r\n            return new ServerModel.Supermarket();\r\n        }\r\n\r\n        ServerApi = ServerApi.SupermarketApi.GetDefault();\r\n    }\r\n\r\n\r\n    export class WaypointDistance {\r\n        constructor(public Precessor: Waypoint,\r\n            public Waypoint: Waypoint,\r\n            public Distance: number,\r\n            calculaterdWaypoints: Waypoint[],\r\n            calculateRoute: boolean) {\r\n            this.LatLng = Waypoint.LatLng;\r\n            calculaterdWaypoints.push(Waypoint);\r\n            for (let wp of Waypoint.GetConnectedWaypoints()) {\r\n                if (calculaterdWaypoints.indexOf(wp) === -1)\r\n                    this.ConnectedWayPoints.push(wp);\r\n            }\r\n            if (calculateRoute) {\r\n                Waypoint.RoutePrecessor(Precessor);\r\n                Waypoint.RouteDistance(Distance);\r\n            } else {\r\n                Waypoint.Precessor(Precessor);\r\n                Waypoint.Distance(Distance);\r\n            }\r\n        }\r\n\r\n        ConnectedWayPoints = new Array<Waypoint>();\r\n        ConnectedDistances = new Array<WaypointDistance>();\r\n        LatLng: L.LatLng;\r\n    }\r\n\r\n}\r\n\r\ninterface KnockoutObservable<T> extends KnockoutSubscribable<T>, KnockoutObservableFunctions<T> {\r\n    Block: boolean;\r\n}\r\n\r\nenum MarkerType {\r\n    Harbour,\r\n    Dummy,\r\n    Waypoint,\r\n    WeatherStation\r\n}"],"sourceRoot":"/source/"}
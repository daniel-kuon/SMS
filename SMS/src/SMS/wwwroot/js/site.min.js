function getMiddle(e){var t=e.getLatLngs()[0],o=e.getLatLngs()[1];return new L.LatLng(t.lat+(o.lat-t.lat)/2,t.lng+(o.lng-t.lng)/2)}function splitPolyline(e){if(2===e.Waypoints.length&&e.DummyHandle instanceof Waypoint){var t=(e.Waypoints[0],e.DummyHandle),o=e.Waypoints[1];return t.RemoveFromPolyline(e),e.DummyHandle=void 0,t.AddToPolyline(e),o.RemoveFromPolyline(e),addDummyHandle(e),void addDummyHandle(model.AddPolyline([t,o]))}throw new Error("Cannot split polyline. Polyline has no dummy handle or less or more than 2 waypoints")}function removePolyline(e){for(var t=0,o=e.Waypoints;t<o.length;t++){var r=o[t];r.RemoveFromPolyline(e)}void 0!==e.DummyHandle&&(e.DummyHandle.RemoveFromPolyline(e),e.DummyHandle.RemoveFromMap()),model.Map.removeLayer(e)}function addDummyHandle(e){void 0===e.DummyHandle&&(e.DummyHandle=model.CreateWaypoint(getMiddle(e),MarkerType.Dummy),e.DummyHandle.AddToPolyline(e))}function redrawPolyline(e){var t=getMiddle(e);void 0===e.DummyHandle&&addDummyHandle(e),e.DummyHandle.Longitude()!==t.lng||e.DummyHandle.Latitude()!==t.lat?e.DummyHandle.SetLatLng(t):e.redraw()}function removeFromPolyline(e,t){removeFromArray(e.getLatLngs(),t),e.redraw()}function removeFromArray(e,t){for(var o=new Array,r=0,n=e;r<n.length;r++){var i=n[r];i!==t&&o.push(i)}if(o.length===e.length)return!1;for(;e.pop(););for(;o.length>0;)e.push(o.shift());return!0}function LoadWaypointConnections(){if(waypointsInitialized&&waypointConnectionsInitialized)for(var e=0,t=model.WaypointConnections();e<t.length;e++){var o=t[e];addDummyHandle(model.AddPolyline([model.GetWayPointById(o.Waypoint1Id),model.GetWayPointById(o.Waypoint2Id)]))}}var __extends=this&&this.__extends||function(e,t){function o(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)},SEntity=ServerModel.Entity,SPerson=ServerModel.Person,SJob=ServerModel.Job,ClientModel;!function(e){var t=function(){function e(){this.Id=ko.observable()}return e.prototype.DeleteOnServer=function(){return this.ServerApi.Delete(this.Id())},e.prototype.SaveToServer=function(){var e=this;return void 0===this.Id()?this.ServerApi.Create(this.ConvertToServerEntity()).done(function(t){return e.Id(t.Id)}):this.ServerApi.Update(this.ConvertToServerEntity())},e.prototype.LoadFromServerEntity=function(e){return this.Id(e.Id),this},e.prototype.ConvertToServerEntity=function(e){void 0===e&&(e=!1);var t=this.CreateServerEntity();return t.Id=this.Id(),t},e.prototype.CopyTo=function(e){e.Id(this.Id())},e.prototype.SaveState=function(){var t=this;t.savedState=new Object;for(var o in t)if(t.hasOwnProperty(o)&&ko.isWriteableObservable(t[o])){var r=ko.unwrap(t[o]);if(r instanceof Array){r=r.slice(0);for(var n=0,i=r;n<i.length;n++){var a=i[n];a instanceof e&&a.SaveState()}}else r instanceof e&&r.SaveState();t.savedState[o]=r}},e.prototype.RevertState=function(t){if(void 0===t&&(t=!1),void 0===this.savedState){if(t)return;throw"No saved state"}var o=this;for(var r in o)if(o.hasOwnProperty(r)&&ko.isWriteableObservable(o[r])){var n=o.savedState[r];if(o[r](n),n instanceof e)n.RevertState();else if(n instanceof Array)for(var i=0,a=n;i<a.length;i++){var s=a[i];s instanceof e&&s.RevertState()}}},e}();e.Entity=t;var o=function(e){function t(){var t=this;e.apply(this,arguments),this.ServerApi=ServerApi.PersonApi.GetDefault(),this.LastName=ko.observable(),this.FirstName=ko.observable(),this.FullName=ko.computed(function(){return t.FirstName()+" "+t.LastName()})}return __extends(t,e),t.prototype.DeleteOnServer=function(){return e.prototype.DeleteOnServer.call(this)},t.prototype.SaveToServer=function(){return e.prototype.SaveToServer.call(this)},t.prototype.LoadFromServerEntity=function(t){return e.prototype.LoadFromServerEntity.call(this,t),this.LastName(t.LastName),this.FirstName(t.FirstName),this},t.prototype.ConvertToServerEntity=function(t){void 0===t&&(t=!1);var o=e.prototype.ConvertToServerEntity.call(this,t);return t||(o.FirstName=this.FirstName(),o.LastName=this.LastName()),o},t.prototype.CreateServerEntity=function(){return new SPerson},t.prototype.CopyTo=function(t){e.prototype.CopyTo.call(this,t),t.LastName(this.LastName()),t.FirstName(this.FirstName())},t}(t);e.Person=o;var r=function(e){function t(){e.apply(this,arguments),this.DueTo=ko.observable(),this.AssignedTo=ko.observable(),this.AssignedToId=ko.observable(),this.Title=ko.observable(),this.Content=ko.observable(),this.Done=ko.observable(),this.SuperJob=ko.observable(),this.SuperJobId=ko.observable(),this.Trip=ko.observable(),this.TripId=ko.observable(),this.SubJobs=ko.observableArray(),this.IsList=!1,this.ServerApi=ServerApi.JobApi.GetDefault()}return __extends(t,e),t.prototype.DeleteOnServer=function(){return e.prototype.DeleteOnServer.call(this)},t.prototype.SaveToServer=function(){return e.prototype.SaveToServer.call(this)},t.prototype.LoadFromServerEntity=function(t){return e.prototype.LoadFromServerEntity.call(this,t),this.DueTo(t.DueTo),this.AssignedToId(t.AssignedToId),this.Title(t.Title),this.Content(t.Content),this.Done(t.Done),this.TripId(t.TripId),this.SuperJobId(t.SuperJobId),this},t.prototype.ConvertToServerEntity=function(t){void 0===t&&(t=!1);var o=e.prototype.ConvertToServerEntity.call(this,t);return t||(o.DueTo=this.DueTo(),o.Title=this.Title(),o.Content=this.Content(),o.Done=this.Done(),o.AssignedToId=this.AssignedToId(),o.TripId=this.TripId(),o.SuperJobId=this.SuperJobId()),o},t.prototype.CreateServerEntity=function(){return new ServerModel.Job},t.prototype.CopyTo=function(t){e.prototype.CopyTo.call(this,t),t.DueTo(this.DueTo()),t.AssignedTo(this.AssignedTo()),t.AssignedToId(this.AssignedToId()),t.Title(this.Title()),t.Content(this.Content()),t.Done(this.Done()),t.SubJobs(this.SubJobs()),t.Trip(this.Trip()),t.TripId(this.TripId()),t.SuperJob(this.SuperJob()),t.SuperJobId(this.SuperJobId())},t}(t);e.Job=r;var n=function(e){function t(t,o,r){var n=this;e.call(this),this.Map=r,this.WaypointNumber=ko.observable(),this.polylines=new Array,this.Latitude=ko.observable(),this.Longitude=ko.observable(),this.Distance=ko.observable(),this.Name=ko.observable(),this.Description=ko.observable(),this.ServerApi=ServerApi.WaypointApi.GetDefault(),this.Latitude(t.lat),this.Longitude(t.lng),this.LatLng=new L.LatLng(t.lat,t.lng),this.Latitude.subscribe(function(e){n.LatLng.lat!==e&&(n.LatLng.lat=e)}),this.Longitude.subscribe(function(e){n.LatLng.lng!==e&&(n.LatLng.lng=e)}),this.markerType=o;var i={draggable:!0};o===MarkerType.Dummy&&(i.opacity=.5),(o===MarkerType.Waypoint||o===MarkerType.Dummy)&&(i.icon=new L.Icon({iconUrl:"/images/waypointhandle.png",iconSize:new L.Point(10,10,!0),className:"waypoint"}));var a=new L.Marker(this.LatLng,i);a.addTo(this.Map),a.Waypoint=this,this.marker=a,a.addEventListener("drag",function(e){n.SetLatLng(n.marker.getLatLng())}),this.LatLng.Polylines=new Array,this.LatLng.Waypoint=this,this.Latitude.subscribe(function(e){n.LatLng.lat!==e&&n.Redraw()}),this.Longitude.subscribe(function(e){n.LatLng.lng!==e&&n.Redraw()})}return __extends(t,e),t.prototype.Popup=function(e){void 0!==this.popup&&(this.Map.removeLayer(this.popup),this.popup=void 0),void 0!==e&&this.marker.bindPopup(e)},t.prototype.Show=function(e){void 0===e&&(e=!1),this.marker.setOpacity(this.marker.Waypoint.IsDummy()?.5:1),e&&$(this.marker._icon).addClass("expose")},t.prototype.Hide=function(){this.marker.setOpacity(.1),$(this.marker._icon).removeClass("expose")},t.prototype.Redraw=function(){this.marker.setLatLng(this.LatLng);for(var e=0;e<this.polylines.length;e++)redrawPolyline(this.polylines[e])},t.prototype.GetConnectedWaypoints=function(){for(var e=this,t=new Array,o=0,r=this.polylines;o<r.length;o++)for(var n=r[o],i=0,a=n.Waypoints;i<a.length;i++){var s=a[i];s!==this&&t.push(s)}return t.sort(function(t,o){return t.LatLng.distanceTo(e.LatLng)-o.LatLng.distanceTo(e.LatLng)})},t.prototype.convertFromDummyHandle=function(){this.marker.setOpacity(1);var e=this.polylines[0].Waypoints[0],t=this.polylines[0].Waypoints[1];splitPolyline(this.polylines[0]),this.markerType=MarkerType.Waypoint,this.SaveToServer().done(function(o){var r=ServerApi.WaypointConnectionApi.GetDefault();r.Disconnect(e.Id(),t.Id()),r.Connect(e.Id(),o.Id),r.Connect(t.Id(),o.Id)})},t.prototype.IsInPolyline=function(e){for(var t=0,o=this.polylines;t<o.length;t++){var r=o[t];if(e===r)return!0}return!1},t.prototype.RemoveFromMap=function(){if(this.markerType!==MarkerType.Dummy)for(var e=0,t=this.polylines;e<t.length;e++){var o=t[e];removePolyline(o)}this.Map.removeLayer(this.marker)},t.prototype.AddToPolyline=function(e){return this.IsInPolyline(e)?!1:(e.DummyHandle!==this&&(e.Waypoints.push(this),e.addLatLng(this.LatLng),e.redraw()),this.LatLng.Polylines.push(e),this.polylines.push(e),console.log(e.Waypoints),!0)},t.prototype.RemoveFromPolyline=function(e){return this.IsInPolyline(e)?(removeFromArray(e.Waypoints,this),removeFromArray(this.polylines,e),removeFromArray(this.LatLng.Polylines,e),removeFromArray(e.getLatLngs(),this.LatLng),e.redraw(),!0):!1},t.prototype.RemoveIfHasZeroOrOnePolylines=function(){return!0},t.prototype.SetLatLng=function(e){this.LatLng.lat=e.lat,this.LatLng.lng=e.lng,this.Latitude(e.lat),this.Longitude(e.lng),this.Redraw()},t.prototype.CenterOnMap=function(){this.Map.setView(this.LatLng)},t.prototype.IsDummy=function(){return this.markerType===MarkerType.Dummy},t.prototype.DeleteOnServer=function(){return e.prototype.DeleteOnServer.call(this)},t.prototype.SaveToServer=function(){return e.prototype.SaveToServer.call(this)},t.prototype.LoadFromServerEntity=function(t){return e.prototype.LoadFromServerEntity.call(this,t),this.Description(t.Description),this.Latitude(t.Latitude),this.Longitude(t.Longitude),this.Name(t.Name),this.WaypointNumber(t.WaypointNumber),this},t.prototype.ConvertToServerEntity=function(t){void 0===t&&(t=!1);var o=e.prototype.ConvertToServerEntity.call(this,t);return o.Description=this.Description(),o.Latitude=this.Latitude(),o.Longitude=this.Longitude(),o.Name=this.Name(),o.WaypointNumber=this.WaypointNumber(),o},t.prototype.CopyTo=function(t){e.prototype.CopyTo.call(this,t),t.Description(this.Description()),t.LatLng=this.LatLng,t.Latitude(this.Latitude()),t.Longitude(this.Longitude()),t.Name(this.Name()),t.WaypointNumber(this.WaypointNumber())},t.prototype.CreateServerEntity=function(){return new ServerModel.Waypoint},t}(t);e.Waypoint=n;var i=function(e){function t(t,o,r){e.call(this,o,MarkerType.Harbour,r),this.ServerApi=ServerApi.HarbourApi.GetDefault(),this.Locations=ko.observableArray(),this.Album=ko.observable(),this.AlbumId=ko.observable(),this.Rating=ko.observable(),this.Content=ko.observable(),this.Name(t)}return __extends(t,e),t.prototype.RemoveIfHasZeroOrOnePolylines=function(){return!1},t.prototype.DeleteOnServer=function(){return e.prototype.DeleteOnServer.call(this)},t.prototype.SaveToServer=function(){return e.prototype.SaveToServer.call(this)},t.prototype.LoadFromServerEntity=function(t){return e.prototype.LoadFromServerEntity.call(this,t),this.AlbumId(t.AlbumId),this.Rating(t.Rating),this},t.prototype.ConvertToServerEntity=function(t){void 0===t&&(t=!1);var o=e.prototype.ConvertToServerEntity.call(this,t);return o.AlbumId=this.AlbumId(),o.AlbumId=this.AlbumId(),o.Rating=this.Rating(),o},t.prototype.CopyTo=function(t){e.prototype.CopyTo.call(this,t),t.Locations(this.Locations()),t.Album(this.Album()),t.AlbumId(this.AlbumId()),t.Rating(this.Rating())},t.prototype.CreateServerEntity=function(){return new ServerModel.Harbour},t}(n);e.Harbour=i;var a=function(e){function t(){e.apply(this,arguments),this.Name=ko.observable(),this.Start=ko.observable(),this.End=ko.observable(),this.Content=ko.observable(),this.Tacks=ko.observableArray(),this.ServerApi=ServerApi.TripApi.GetDefault()}return __extends(t,e),t.prototype.LoadFromServerEntity=function(t){var o=e.prototype.LoadFromServerEntity.call(this,t);return o.Name(t.Name),o.Start(t.Start),o.End(t.End),o.Content(t.Content),o},t.prototype.ConvertToServerEntity=function(t){void 0===t&&(t=!1);var o=e.prototype.ConvertToServerEntity.call(this,t);return t||(o.Name=this.Name(),o.Start=this.Start(),o.End=this.End(),o.Content=this.Content()),o},t.prototype.CopyTo=function(t){e.prototype.CopyTo.call(this,t),t.Name(this.Name()),t.Start(this.Start()),t.End(this.End()),t.Content(this.Content()),t.Tacks(this.Tacks())},t.prototype.CreateServerEntity=function(){return new ServerModel.Trip},t}(t);e.Trip=a;var s=function(e){function t(){e.apply(this,arguments),this.Street=ko.observable(),this.Zip=ko.observable(),this.Town=ko.observable(),this.Comment=ko.observable(),this.ServerApi=ServerApi.AddressApi.GetDefault()}return __extends(t,e),t.prototype.DeleteOnServer=function(){return e.prototype.DeleteOnServer.call(this)},t.prototype.SaveToServer=function(){return e.prototype.SaveToServer.call(this)},t.prototype.LoadFromServerEntity=function(t){var o=e.prototype.LoadFromServerEntity.call(this,t);return o.Street(t.Street),o.Zip(t.Zip),o.Town(t.Town),o.Comment(t.Comment),o},t.prototype.ConvertToServerEntity=function(t){void 0===t&&(t=!1);var o=e.prototype.ConvertToServerEntity.call(this,t);return t||(o.Street=this.Street(),o.Zip=this.Zip(),o.Town=this.Town(),o.Comment=this.Comment()),o},t.prototype.CopyTo=function(t){e.prototype.CopyTo.call(this,t),t.Street(this.Street()),t.Zip(this.Zip()),t.Town(this.Town()),t.Comment(this.Comment())},t.prototype.CreateServerEntity=function(){return new ServerModel.Address},t}(t);e.Address=s;var p=function(e){function t(){e.apply(this,arguments),this.AlbumId=ko.observable(),this.Path=ko.observable(),this.Comment=ko.observable(),this.ServerApi=ServerApi.ImageApi.GetDefault()}return __extends(t,e),t.prototype.DeleteOnServer=function(){return e.prototype.DeleteOnServer.call(this)},t.prototype.SaveToServer=function(){return e.prototype.SaveToServer.call(this)},t.prototype.LoadFromServerEntity=function(t){var o=e.prototype.LoadFromServerEntity.call(this,t);return o.AlbumId(t.AlbumId),o.Path(t.Path),o.Comment(t.Comment),o},t.prototype.ConvertToServerEntity=function(t){void 0===t&&(t=!1);var o=e.prototype.ConvertToServerEntity.call(this,t);return t||(o.AlbumId=this.AlbumId(),o.Path=this.Path(),o.Comment=this.Comment()),o},t.prototype.CopyTo=function(t){e.prototype.CopyTo.call(this,t),t.AlbumId(this.AlbumId()),t.Path(this.Path()),t.Comment(this.Comment())},t.prototype.CreateServerEntity=function(){return new ServerModel.Image},t}(t);e.Image=p;var l=function(e){function t(){e.apply(this,arguments),this.StandAlone=ko.observable(),this.Comment=ko.observable(),this.Images=ko.observableArray(),this.ServerApi=ServerApi.AlbumApi.GetDefault()}return __extends(t,e),t.prototype.DeleteOnServer=function(){return e.prototype.DeleteOnServer.call(this)},t.prototype.SaveToServer=function(){return e.prototype.SaveToServer.call(this)},t.prototype.LoadFromServerEntity=function(t){var o=e.prototype.LoadFromServerEntity.call(this,t);return o.StandAlone(t.StandAlone),o.Comment(t.Comment),o},t.prototype.ConvertToServerEntity=function(t){void 0===t&&(t=!1);var o=e.prototype.ConvertToServerEntity.call(this,t);if(!t){o.StandAlone=this.StandAlone(),o.Comment=this.Comment(),o.Images=new Array;for(var r=0,n=this.Images();r<n.length;r++){var i=n[r];o.Images.push(i.ConvertToServerEntity())}}return o},t.prototype.CopyTo=function(t){e.prototype.CopyTo.call(this,t),t.StandAlone(this.StandAlone()),t.Comment(this.Comment()),t.Images(this.Images())},t.prototype.CreateServerEntity=function(){return new ServerModel.Album},t}(t);e.Album=l;var u=function(e){function t(){e.apply(this,arguments),this.Start=ko.observable(),this.End=ko.observable(),this.Waypoints=ko.observableArray(),this.Crew=ko.observableArray(),this.ServerApi=ServerApi.TackApi.GetDefault()}return __extends(t,e),t.prototype.DeleteOnServer=function(){return e.prototype.DeleteOnServer.call(this)},t.prototype.SaveToServer=function(){return e.prototype.SaveToServer.call(this)},t.prototype.LoadFromServerEntity=function(t){var o=e.prototype.LoadFromServerEntity.call(this,t);return o.Start(t.Start),o.End(t.End),o},t.prototype.ConvertToServerEntity=function(t){void 0===t&&(t=!1);var o=e.prototype.ConvertToServerEntity.call(this,t);return t||(o.Start=this.Start(),o.End=this.End()),o},t.prototype.CopyTo=function(t){e.prototype.CopyTo.call(this,t),t.Start(this.Start()),t.End(this.End()),t.Waypoints(this.Waypoints()),t.Crew(this.Crew())},t.prototype.CreateServerEntity=function(){return new ServerModel.Tack},t}(t);e.Tack=u;var d=function(e){function t(){e.apply(this,arguments),this.HarbourId=ko.observable(),this.Website=ko.observable(),this.Name=ko.observable(),this.Rating=ko.observable(),this.Address=ko.observable(),this.AddressId=ko.observable(),this.ServerApi=ServerApi.LocationApi.GetDefault()}return __extends(t,e),t.prototype.DeleteOnServer=function(){return e.prototype.DeleteOnServer.call(this)},t.prototype.SaveToServer=function(){return e.prototype.SaveToServer.call(this)},t.prototype.LoadFromServerEntity=function(t){var o=e.prototype.LoadFromServerEntity.call(this,t);return o.HarbourId(t.HarbourId),o.Website(t.Website),o.Name(t.Name),o.Rating(t.Rating),o},t.prototype.ConvertToServerEntity=function(t){void 0===t&&(t=!1);var o=e.prototype.ConvertToServerEntity.call(this,t);return t||(o.HarbourId=this.HarbourId(),o.Website=this.Website(),o.Name=this.Name(),o.Rating=this.Rating()),o},t.prototype.CopyTo=function(t){e.prototype.CopyTo.call(this,t),t.HarbourId(this.HarbourId()),t.Website(this.Website()),t.Name(this.Name()),t.Rating(this.Rating())},t.prototype.CreateServerEntity=function(){return new ServerModel.Location},t}(t);e.Location=d;var y=function(e){function t(){e.apply(this,arguments),this.ServerApi=ServerApi.RestaurantApi.GetDefault()}return __extends(t,e),t.prototype.DeleteOnServer=function(){return e.prototype.DeleteOnServer.call(this)},t.prototype.SaveToServer=function(){return e.prototype.SaveToServer.call(this)},t.prototype.LoadFromServerEntity=function(t){var o=e.prototype.LoadFromServerEntity.call(this,t);return o},t.prototype.ConvertToServerEntity=function(t){void 0===t&&(t=!1);var o=e.prototype.ConvertToServerEntity.call(this,t);return o},t.prototype.CopyTo=function(t){e.prototype.CopyTo.call(this,t)},t.prototype.CreateServerEntity=function(){return new ServerModel.Restaurant},t}(d);e.Restaurant=y;var h=function(e){function t(){e.apply(this,arguments),this.ServerApi=ServerApi.SupermarketApi.GetDefault()}return __extends(t,e),t.prototype.DeleteOnServer=function(){return e.prototype.DeleteOnServer.call(this)},t.prototype.SaveToServer=function(){return e.prototype.SaveToServer.call(this)},t.prototype.LoadFromServerEntity=function(t){var o=e.prototype.LoadFromServerEntity.call(this,t);return o},t.prototype.ConvertToServerEntity=function(t){void 0===t&&(t=!1);var o=e.prototype.ConvertToServerEntity.call(this,t);return o},t.prototype.CopyTo=function(t){e.prototype.CopyTo.call(this,t)},t.prototype.CreateServerEntity=function(){return new ServerModel.Supermarket},t}(d);e.Supermarket=h;var v=function(){function e(e,t,o,r){this.Precessor=e,this.Waypoint=t,this.Distance=o,this.ConnectedWayPoints=new Array,this.ConnectedDistances=new Array,this.LatLng=t.LatLng,r.push(t);for(var n=0,i=t.GetConnectedWaypoints();n<i.length;n++){var a=i[n];-1===r.indexOf(a)&&this.ConnectedWayPoints.push(a)}}return e}();e.WaypointDistance=v}(ClientModel||(ClientModel={}));var MarkerType;!function(e){e[e.Harbour=0]="Harbour",e[e.Dummy=1]="Dummy",e[e.Waypoint=2]="Waypoint",e[e.WeatherStation=3]="WeatherStation"}(MarkerType||(MarkerType={}));var __extends=this&&this.__extends||function(e,t){function o(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)},ServerApi;!function(e){!function(e){e[e.POST=0]="POST",e[e.GET=1]="GET",e[e.PUT=2]="PUT",e[e.DELETE=3]="DELETE"}(e.HttpMethod||(e.HttpMethod={}));var t=e.HttpMethod,o=function(){function e(e){this.baseUrl=e}return e.prototype.BuildRequestBody=function(e,o,r){return{contentType:"application/json; charset=utf-8",dataType:"json",method:t[o],url:this.baseUrl+"/"+e,data:JSON.stringify(r)}},e.prototype.Get=function(e){return this.CreateRequest(void 0===e?this.BuildRequestBody("",t.GET):this.BuildRequestBody(e.toString(),t.GET))},e.prototype.Delete=function(e){return this.CreateRequest(this.BuildRequestBody(e.toString(),t.DELETE))},e.prototype.Create=function(e){return this.CreateRequest(this.BuildRequestBody("",t.POST,e))},e.prototype.Update=function(e){return this.CreateRequest(this.BuildRequestBody(e.Id.toString(),t.PUT,e))},e.prototype.CreateRequest=function(e){return $.ajax(e).fail(function(e){alert(e),console.log(e)})},e}();e.Api=o;var r=function(){function e(e){this.baseUrl=e}return e.prototype.Get=function(){return this.CreateRequest(this.BuildRequestBody("",t.GET))},e.prototype.Connect=function(e,o){return this.CreateRequest(this.BuildRequestBody(e+"/"+o,t.POST))},e.prototype.Disconnect=function(e,o){return this.CreateRequest(this.BuildRequestBody(e+"/"+o,t.DELETE))},e.prototype.CreateRequest=function(e){return $.ajax(e).fail(function(e){alert(e),console.log(e)})},e.prototype.BuildRequestBody=function(e,o,r){return{contentType:"application/json; charset=utf-8",dataType:"json",method:t[o],url:this.baseUrl+"/"+e,data:JSON.stringify(r)}},e}();e.ConnectionApi=r;var n=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t.GetDefault=function(){return void 0===this["default"]&&(this["default"]=new t("/api/Harbours")),this["default"]},t}(o);e.HarbourApi=n;var i=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t.GetDefault=function(){return void 0===this["default"]&&(this["default"]=new t("/api/Waypoints")),this["default"]},t}(o);e.WaypointApi=i;var a=function(){function e(e){this.baseUrl=e}return e.GetDefault=function(){return void 0===this["default"]&&(this["default"]=new e("/api/WaypointConnections")),this["default"]},e.prototype.Get=function(){return this.CreateRequest(this.BuildRequestBody("",t.GET))},e.prototype.Connect=function(e,o){return this.CreateRequest(this.BuildRequestBody(e+"/"+o,t.POST))},e.prototype.Disconnect=function(e,o){return this.CreateRequest(this.BuildRequestBody(e+"/"+o,t.DELETE))},e.prototype.CreateRequest=function(e){return $.ajax(e).fail(function(e){alert(e),console.log(e)})},e.prototype.BuildRequestBody=function(e,o,r){return{contentType:"application/json; charset=utf-8",dataType:"json",method:t[o],url:this.baseUrl+"/"+e,data:JSON.stringify(r)}},e}();e.WaypointConnectionApi=a;var s=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t.GetDefault=function(){return void 0===this["default"]&&(this["default"]=new t("/api/People")),this["default"]},t}(o);e.PersonApi=s;var p=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t.GetDefault=function(){return void 0===this["default"]&&(this["default"]=new t("/api/Jobs")),this["default"]},t}(o);e.JobApi=p;var l=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t.GetDefault=function(){return void 0===this["default"]&&(this["default"]=new t("/api/Trips")),this["default"]},t}(o);e.TripApi=l;var u=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t.GetDefault=function(){return void 0===this["default"]&&(this["default"]=new t("/api/Tacks")),this["default"]},t}(o);e.TackApi=u;var d=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t.GetDefault=function(){return void 0===this["default"]&&(this["default"]=new t("/api/Addresses")),this["default"]},t}(o);e.AddressApi=d;var y=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t.GetDefault=function(){return void 0===this["default"]&&(this["default"]=new t("/api/Images")),this["default"]},t}(o);e.ImageApi=y;var h=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t.GetDefault=function(){return void 0===this["default"]&&(this["default"]=new t("/api/Albums")),this["default"]},t}(o);e.AlbumApi=h;var v=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t.GetDefault=function(){return void 0===this["default"]&&(this["default"]=new t("/api/Locations")),this["default"]},t}(o);e.LocationApi=v;var c=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t.GetDefault=function(){return void 0===this["default"]&&(this["default"]=new t("/api/Supermarkets")),this["default"]},t}(o);e.SupermarketApi=c;var f=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t.GetDefault=function(){return void 0===this["default"]&&(this["default"]=new t("/api/Restaurants")),this["default"]},t}(o);e.RestaurantApi=f}(ServerApi||(ServerApi={}));var __extends=this&&this.__extends||function(e,t){function o(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)},ServerModel;!function(e){var t=function(){function e(){}return e}();e.Entity=t;var o=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t.GetType=function(){return"Waypoint"},t}(t);e.Waypoint=o;var r=function(){function e(){}return e}();e.WaypointConnection=r;var n=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t.GetType=function(){return"Harbour"},t}(o);e.Harbour=n;var i=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t}(t);e.Person=i;var a=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t}(t);e.Job=a;var s=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t}(t);e.Trip=s;var p=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t}(t);e.Address=p;var l=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t}(t);e.Image=l;var u=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t}(t);e.Album=u;var d=function(){function e(){}return e}();e.WaypointTack=d;var y=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t}(t);e.Tack=y;var h=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t.GetType=function(){return"Location"},t}(t);e.Location=h;var v=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t.GetType=function(){return"Restaurant"},t}(h);e.Restaurant=v;var c=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t.GetType=function(){return"Supermarket"},t}(h);e.Supermarket=c}(ServerModel||(ServerModel={}));var Waypoint=ClientModel.Waypoint,Harbour=ClientModel.Harbour,WaypointDistance=ClientModel.WaypointDistance,MapMode;!function(e){e[e.AdminView=0]="AdminView",e[e.TripPlanning=1]="TripPlanning",e[e.RouteDrawing=2]="RouteDrawing"}(MapMode||(MapMode={}));var SailingMapViewModel=function(){function e(){var e=this;this.Harbours=ko.observableArray(),this.Waypoints=ko.observableArray(),this.WaypointConnections=ko.observableArray(),this.SelectedHarbour=ko.observable(),this.SelectedWaypoint=ko.observable(),this.EditingHarbour=ko.observable(),this.EditingWaypoint=ko.observable(),this.WaypointMarkers=new Array,this.RemoveHarbour=function(){e.SelectedWaypoint().RemoveFromMap(),e.Waypoints.remove(e.SelectedWaypoint())},this.RemoveWaypoint=function(){e.SelectedHarbour().RemoveFromMap(),e.Harbours.remove(e.SelectedHarbour()),e.Harbours.remove(e.SelectedHarbour())},this.CenterWaypoint=function(e){e.CenterOnMap()},this.SelectWaypoint=function(t){e.SelectedWaypoint(t)},this.SelectHarbour=function(t){e.SelectedHarbour(t)},this.SaveHarbour=function(){e.CopyHarbour(e.EditingHarbour(),e.SelectedHarbour())},this.SaveWaypoint=function(){e.CopyWaypoint(e.EditingWaypoint(),e.SelectedWaypoint())},this.RemovePolyline=function(t){e.Map.removeLayer(t),e.DrawingPolyline=void 0},L.mapbox.accessToken="pk.eyJ1IjoiZGFuaWVsLWt1b24iLCJhIjoiY2lldnVtY29iMDBiOHQxbTBvZzBqZWl6cCJ9.UEc2YqH59pB1YTpv22vg8A",this.Map=L.mapbox.map("map","mapbox.streets").setView([51,10],9),this.Map.addEventListener("mousemove",function(t){e.GetMapMode()===MapMode.RouteDrawing&&(e.DrawingLatLng.lat=t.latlng.lat,e.DrawingLatLng.lng=t.latlng.lng,e.DrawingPolyline.redraw());for(var o=0,r=e.WaypointMarkers;o<r.length;o++){var n=r[o];n.setOpacity(n.Point.distanceTo(t.containerPoint)<150?n.Waypoint.IsDummy()?.5:1:n.Waypoint.IsDummy()?0:.8)}}),this.Map.addEventListener("click",function(t){if(e.GetMapMode()===MapMode.RouteDrawing){var o=model.CreateWaypoint(t.latlng,MarkerType.Waypoint),r=e.DrawingPolyline.Waypoints[0].Id();o.SaveToServer().done(function(e){ServerApi.WaypointConnectionApi.GetDefault().Connect(e.Id,r)}),o.AddToPolyline(e.DrawingPolyline),addDummyHandle(e.DrawingPolyline),removeFromPolyline(e.DrawingPolyline,e.DrawingLatLng),e.DrawingPolyline=e.AddPolyline(o),e.DrawingLatLng=new L.LatLng(t.latlng.lat,t.latlng.lng),e.DrawingPolyline.addLatLng(e.DrawingLatLng)}}),this.Map.addEventListener("dblclick",function(t){e.GetMapMode()===MapMode.RouteDrawing&&(t.originalEvent.cancelBubble=!0,t.originalEvent.preventDefault(),t.originalEvent.stopPropagation(),e.DrawingPolyline.addLatLng(t.latlng),e.DrawingLatLng=t.latlng)}),$(document).keyup(function(t){e.GetMapMode()===MapMode.RouteDrawing&&27===t.keyCode&&e.RemovePolyline(e.DrawingPolyline)}),this.Map.addEventListener("move",function(t){for(var o=0,r=e.WaypointMarkers;o<r.length;o++){var n=r[o];n.Point=e.Map.latLngToContainerPoint(n.getLatLng())}}),this.Map.addEventListener("zoom",function(t){for(var o=0,r=e.WaypointMarkers;o<r.length;o++){var n=r[o];n.Point=e.Map.latLngToContainerPoint(n.getLatLng())}})}return e.prototype.AddHarbour=function(){var e=this.CreateHarbour("Hafen "+this.Harbours.length,this.Map.getCenter());this.Harbours.push(e),e.SaveToServer()},e.prototype.CopyHarbour=function(e,t){this.CopyWaypoint(e,t)},e.prototype.CopyWaypoint=function(e,t){t.WaypointNumber(e.WaypointNumber()),t.Latitude(e.Latitude()),t.Longitude(e.Longitude()),t.Name(e.Name()),t.Description(e.Description())},e.prototype.AddPolyline=function(e){var t=new L.Polyline([]);if(t.addTo(this.Map),t.Waypoints=new Array,void 0!==e)if(e instanceof Waypoint)e.AddToPolyline(t);else for(var o=0,r=e;o<r.length;o++){var n=r[o];n.AddToPolyline(t)}return t},e.prototype.GetMapMode=function(){return void 0!==this.DrawingPolyline&&void 0!==this.DrawingLatLng?MapMode.RouteDrawing:MapMode.AdminView},e.prototype.GetWayPointById=function(e){for(var t=0,o=this.Waypoints();t<o.length;t++){var r=o[t];if(r.Id()===e)return r}for(var n=0,i=this.Harbours();n<i.length;n++){var r=i[n];if(r.Id()===e)return r}throw"No Waypoint with id "+e+" in model"},e.prototype.CalculateDistances=function(e){var t=[e],o=new Array,r=new Array;for(o.push(new WaypointDistance(null,e,0,t));o.length>0;){for(var n=Number.POSITIVE_INFINITY,i=void 0,a=0,s=o;a<s.length;a++){var p=s[a];if(0===p.ConnectedWayPoints.length)removeFromArray(o,p),r.push(p);else{var l=p.Distance+p.ConnectedWayPoints[0].LatLng.distanceTo(p.LatLng);n>l&&(n=l,i=p)}}void 0!==i&&o.push(new WaypointDistance(i.Waypoint,i.ConnectedWayPoints.shift(),n,t))}for(var u=0,d=r;u<d.length;u++){var p=d[u];p.Waypoint.Distance(p.Distance)}for(var y=0,h=model.Harbours();y<h.length;y++){var v=h[y];v.Popup(Math.round(v.Distance()).toString())}},e.prototype.CreateWaypoint=function(e,t){var o=new Waypoint(e,t,model.Map);return this.InitializeWaypoint(o,t),o},e.prototype.InitializeWaypoint=function(e,t){(t===MarkerType.Waypoint||t===MarkerType.Dummy)&&(this.WaypointMarkers.push(e.marker),e.marker.Point=model.Map.latLngToContainerPoint(e.LatLng)),e.marker.addEventListener("click",function(o){t===MarkerType.Dummy&&(model.Waypoints.push(e),e.convertFromDummyHandle()),model.GetMapMode()===MapMode.RouteDrawing&&(e.IsInPolyline(model.DrawingPolyline)?(removePolyline(model.DrawingPolyline),model.DrawingPolyline=void 0,model.DrawingLatLng=void 0):(ServerApi.WaypointConnectionApi.GetDefault().Connect(e.Id(),model.DrawingPolyline.Waypoints[0].Id()),e.AddToPolyline(model.DrawingPolyline),removeFromPolyline(model.DrawingPolyline,model.DrawingLatLng),addDummyHandle(model.DrawingPolyline),model.DrawingPolyline=void 0,model.DrawingLatLng=void 0));

}),e.marker.addEventListener("dblclick",function(t){model.DrawingPolyline=model.AddPolyline(e),model.DrawingLatLng=new L.LatLng(t.latlng.lat,t.latlng.lng),model.DrawingPolyline.addLatLng(model.DrawingLatLng)}),t===MarkerType.Dummy?e.marker.addOneTimeEventListener("drag",function(t){e.convertFromDummyHandle(),model.Waypoints.push(e)}):t===MarkerType.Waypoint&&e.Name("Wegpunkt "+(model.Waypoints().length+1)),e.marker.addEventListener("dragend",function(t){e.SaveToServer()})},e.prototype.CreateHarbour=function(e,t){var o=new Harbour(e,t,this.Map);return this.InitializeWaypoint(o,MarkerType.Harbour),o},e}(),harboursLoaded=!1,waypointsLoaded=!1,personsLoaded=!1,model,harbourApi=new ServerApi.HarbourApi("/api/Harbours"),waypointApi=new ServerApi.WaypointApi("/api/Waypoints"),personApi=new ServerApi.PersonApi("/api/People"),waypointConnectionApi=new ServerApi.WaypointConnectionApi("/api/WaypointConnections");model=new SailingMapViewModel,ko.applyBindings(model),$("#harbourData").on("mouseenter","tr",function(){model.CalculateDistances(ko.contextFor(this).$data)}),$("#navPoints").on("mouseenter","tr",function(){ko.contextFor(this).$data.Show(!0)}),$("#navPoints").on("mouseleave","tr",function(){ko.contextFor(this).$data.Hide()});var waypointsInitialized=!1,waypointConnectionsInitialized=!1;waypointApi.Get().done(function(e){for(var t=0,o=e;t<o.length;t++){var r=o[t];r.Type===ServerModel.Waypoint.GetType()?model.Waypoints.push(model.CreateWaypoint(L.latLng(r.Latitude,r.Longitude),MarkerType.Waypoint).LoadFromServerEntity(r)):r.Type===ServerModel.Harbour.GetType()&&model.Harbours.push(model.CreateHarbour(r.Name,L.latLng(r.Latitude,r.Longitude)).LoadFromServerEntity(r))}waypointsInitialized=!0,LoadWaypointConnections()}),waypointConnectionApi.Get().done(function(e){for(var t=0,o=e;t<o.length;t++){var r=o[t];model.WaypointConnections.push(r)}waypointConnectionsInitialized=!0,LoadWaypointConnections()});var MapHelper=function(){function e(){}return e}(),personDeails=$("#personDetails"),Person=ClientModel.Person,deletePerson=$("#deletePerson"),adminPersonViewModel,AdminPersonViewModel;!function(e){var t=function(){function e(){var e=this;this.Model=this,this.People=ko.observableArray(),this.PersonApi=ServerApi.PersonApi.GetDefault(),this.CurrentPerson=ko.observable(new Person),this.NewPerson=ko.computed(function(){return void 0===e.CurrentPerson().Id()}),this.PersonApi.Get().done(function(t){for(var o=0,r=t;o<r.length;o++){var n=r[o];e.People.push((new Person).LoadFromServerEntity(n))}})}return e.prototype.SavePerson=function(){adminPersonViewModel.CurrentPerson().SaveToServer().done(function(){personDeails.modal("hide"),adminPersonViewModel.CurrentPerson(new Person)})},e.prototype.CancelEditPerson=function(){adminPersonViewModel.CurrentPerson().RevertState(!0),adminPersonViewModel.CurrentPerson(new Person),personDeails.modal("hide")},e.prototype.DeletePerson=function(){adminPersonViewModel.CurrentPerson().DeleteOnServer().done(function(){adminPersonViewModel.People.remove(adminPersonViewModel.CurrentPerson()),deletePerson.modal("hide"),adminPersonViewModel.CurrentPerson(void 0)})},e.prototype.AddPerson=function(){adminPersonViewModel.CurrentPerson(new Person),adminPersonViewModel.People.push(adminPersonViewModel.CurrentPerson()),adminPersonViewModel.SavePerson()},e.prototype.SelectPerson=function(e){adminPersonViewModel.CurrentPerson(e),e.SaveState()},e}();e.Model=t}(AdminPersonViewModel||(AdminPersonViewModel={})),adminPersonViewModel=new AdminPersonViewModel.Model,ko.applyBindings(adminPersonViewModel);var m="",HomeJobsViewModel;!function(e){var t,o=function(){function e(){var e=this;this.JobLists=ko.observableArray(),this.Persons=ko.observableArray(),this.Trip=ko.observableArray(),ServerApi.PersonApi.GetDefault().Get().done(function(t){for(var o=0,r=t;o<r.length;o++){var n=r[o];e.Persons.push((new Person).LoadFromServerEntity(n))}}),ServerApi.JobListApi.GetDefault().Get().done(function(t){for(var o=0,r=t;o<r.length;o++){var n=r[o];e.JobLists.push((new Job).LoadFromServerEntity(n))}}),this.Seed()}return e.prototype.Seed=function(){var e=new Person;e.LastName("Kuon"),e.FirstName("Daniel"),this.Persons.push(e);var t=new Job;t.Title("L1"),t.Content("<b>L1</b>"),t.Done(!0),t.AssignedTo(e),t.DueTo(new Date);var o=new Job;o.Title("L1"),o.Content("<b>L1</b>"),o.Done(!1),o.AssignedTo(e),o.DueTo(new Date),t.SubJobs.push(o),this.JobLists.push(t);var r=new Job;r.Title("L1"),r.Content("<b>L1</b>"),r.Done(!0),r.AssignedTo(e),r.DueTo(new Date),r.SubJobs.push(o),r.SubJobs.push(o),t.SubJobs.push(r)},e}();t=new o,m=t,ko.applyBindings(t);var r=function(e){var t=ko.contextFor(e.target.bodyElement);console.log(t)};tinymce.init({selector:"h2.editable",inline:!0,toolbar:"undo redo",menubar:!1}),tinymce.init({selector:"div.editable",inline:!0,plugins:["advlist autolink lists link image charmap print preview anchor","searchreplace visualblocks code fullscreen","insertdatetime media table contextmenu paste"],toolbar:"insertfile undo redo | styleselect | bold italic | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | link image",setup:function(e){e.on("blur",r)}})}(HomeJobsViewModel||(HomeJobsViewModel={}));var SHarbour=ServerModel.Harbour,MapViewModel=function(){function e(){var e=this;this.WaypointsLoaded=!1,this.WaypointConnectionsLoaded=!1,this.HarboursLoaded=!1,this.PersonsLoaded=!1,this.JobsLoaded=!1,this.TripsLoaded=!1,this.AddressesLoaded=!1,this.ImagesLoaded=!1,this.AlbumsLoaded=!1,this.WaypointTacksLoaded=!1,this.TacksLoaded=!1,this.LocationsLoaded=!1,this.Waypoints=ko.observableArray(),this.WaypointConnections=ko.observableArray(),this.Harbours=ko.observableArray(),this.Persons=ko.observableArray(),this.Jobs=ko.observableArray(),this.Trips=ko.observableArray(),this.Addresses=ko.observableArray(),this.Images=ko.observableArray(),this.Albums=ko.observableArray(),this.Tacks=ko.observableArray(),this.Locations=ko.observableArray(),this.Supermarkets=ko.observableArray(),this.Restaurants=ko.observableArray(),this.SelectedWaypoint=ko.observable(),this.SelectedHarbour=ko.observable(),this.SelectedPerson=ko.observable(),this.SelectedJob=ko.observable(),this.SelectedTrip=ko.observable(),this.SelectedAddress=ko.observable(),this.SelectedImage=ko.observable(),this.SelectedAlbum=ko.observable(),this.SelectedTack=ko.observable(),this.SelectedLocation=ko.observable(),this.SelectedSupermarket=ko.observable(),this.SelectedRestaurant=ko.observable(),L.mapbox.accessToken="pk.eyJ1IjoiZGFuaWVsLWt1b24iLCJhIjoiY2lldnVtY29iMDBiOHQxbTBvZzBqZWl6cCJ9.UEc2YqH59pB1YTpv22vg8A",this.Map=L.mapbox.map("map","mapbox.streets").setView([51,10],9),ServerApi.WaypointApi.GetDefault().Get().done(function(t){for(var o=function(t){if(t.Type===ServerModel.Waypoint.GetType())e.Waypoints.push(new ClientModel.Waypoint(L.latLng(t.Latitude,t.Longitude),MarkerType.Waypoint,e.Map).LoadFromServerEntity(t));else if(t.Type===ServerModel.Harbour.GetType()){var o=new ClientModel.Harbour(t.Name,L.latLng(t.Latitude,t.Longitude),e.Map).LoadFromServerEntity(t);o.marker.addEventListener("click",function(){e.SelectedHarbour(o)}),e.Harbours.push(o)}},r=0,n=t;r<n.length;r++){var i=n[r];o(i)}e.WaypointsLoaded=!0,e.InitializeModel()}),ServerApi.WaypointConnectionApi.GetDefault().Get().done(function(t){for(var o=0,r=t;o<r.length;o++){var n=r[o];e.WaypointConnections.push(n)}e.WaypointConnectionsLoaded=!0,e.InitializeModel()}),ServerApi.PersonApi.GetDefault().Get().done(function(t){for(var o=0,r=t;o<r.length;o++){var n=r[o];e.Persons.push((new ClientModel.Person).LoadFromServerEntity(n))}e.PersonsLoaded=!0,e.InitializeModel()}),ServerApi.JobApi.GetDefault().Get().done(function(t){for(var o=0,r=t;o<r.length;o++){var n=r[o];e.Jobs.push((new ClientModel.Job).LoadFromServerEntity(n))}e.JobsLoaded=!0,e.InitializeModel()}),ServerApi.TripApi.GetDefault().Get().done(function(t){for(var o=0,r=t;o<r.length;o++){var n=r[o];e.Trips.push((new ClientModel.Trip).LoadFromServerEntity(n))}e.TripsLoaded=!0,e.InitializeModel()}),ServerApi.AddressApi.GetDefault().Get().done(function(t){for(var o=0,r=t;o<r.length;o++){var n=r[o];e.Addresses.push((new ClientModel.Address).LoadFromServerEntity(n))}e.AddressesLoaded=!0,e.InitializeModel()}),ServerApi.ImageApi.GetDefault().Get().done(function(t){for(var o=0,r=t;o<r.length;o++){var n=r[o];e.Images.push((new ClientModel.Image).LoadFromServerEntity(n))}e.ImagesLoaded=!0,e.InitializeModel()}),ServerApi.AlbumApi.GetDefault().Get().done(function(t){for(var o=0,r=t;o<r.length;o++){var n=r[o];e.Albums.push((new ClientModel.Album).LoadFromServerEntity(n))}e.AlbumsLoaded=!0,e.InitializeModel()}),ServerApi.TackApi.GetDefault().Get().done(function(t){for(var o=0,r=t;o<r.length;o++){var n=r[o];e.Tacks.push((new ClientModel.Tack).LoadFromServerEntity(n))}e.TacksLoaded=!0,e.InitializeModel()}),ServerApi.LocationApi.GetDefault().Get().done(function(t){for(var o=0,r=t;o<r.length;o++){var n=r[o];n.Type===ServerModel.Location.GetType()?e.Locations.push((new ClientModel.Location).LoadFromServerEntity(n)):n.Type===ServerModel.Restaurant.GetType()?e.Restaurants.push((new ClientModel.Restaurant).LoadFromServerEntity(n)):n.Type===ServerModel.Supermarket.GetType()&&e.Supermarkets.push((new ClientModel.Supermarket).LoadFromServerEntity(n))}e.LocationsLoaded=!0,e.InitializeModel()})}return e.prototype.InitializeModel=function(){if(this.WaypointsLoaded&&this.WaypointConnectionsLoaded&&this.HarboursLoaded&&this.PersonsLoaded&&this.JobsLoaded&&this.TripsLoaded&&this.AddressesLoaded&&this.ImagesLoaded&&this.AlbumsLoaded&&this.WaypointTacksLoaded&&this.TacksLoaded&&this.LocationsLoaded){for(var e=0,t=this.Harbours();e<t.length;e++){var o=t[e];o.Album(this.GetAlbumById(o.AlbumId()))}for(var r=0,n=this.Jobs();r<n.length;r++){var o=n[r];void 0!==o.AssignedToId()&&o.AssignedTo(this.GetPersonById(o.AssignedToId())),void 0!==o.TripId()&&o.Trip(this.GetTripById(o.TripId())),void 0!==o.SuperJobId()&&(o.SuperJob(this.GetJobById(o.SuperJobId())),o.SuperJob().SubJobs.push(o))}for(var i=0,a=this.Locations();i<a.length;i++){var o=a[i];o.Address(this.GetAddressById(o.AddressId())),this.GetHarbourById(o.HarbourId()).Locations.push(o)}for(var s=0,p=this.Images();s<p.length;s++){var o=p[s];this.GetAlbumById(o.AlbumId()).Images.push(o)}}},e.prototype.GetWaypointById=function(e){for(var t=0,o=this.Waypoints();t<o.length;t++){var r=o[t];if(r.Id()===e)return r}for(var n=0,i=this.Harbours();n<i.length;n++){var r=i[n];if(r.Id()===e)return r}throw"No Waypoint with id "+e+" found"},e.prototype.GetHarbourById=function(e){for(var t=0,o=this.Harbours();t<o.length;t++){var r=o[t];if(r.Id()===e)return r}throw"No Harbour with id "+e+" found"},e.prototype.GetPersonById=function(e){for(var t=0,o=this.Persons();t<o.length;t++){var r=o[t];if(r.Id()===e)return r}throw"No Person with id "+e+" found"},e.prototype.GetJobById=function(e){for(var t=0,o=this.Jobs();t<o.length;t++){var r=o[t];if(r.Id()===e)return r}throw"No Job with id "+e+" found"},e.prototype.GetTripById=function(e){for(var t=0,o=this.Trips();t<o.length;t++){var r=o[t];if(r.Id()===e)return r}throw"No Trip with id "+e+" found"},e.prototype.GetAddressById=function(e){for(var t=0,o=this.Addresses();t<o.length;t++){var r=o[t];if(r.Id()===e)return r}throw"No Address with id "+e+" found"},e.prototype.GetImageById=function(e){for(var t=0,o=this.Images();t<o.length;t++){var r=o[t];if(r.Id()===e)return r}throw"No Image with id "+e+" found"},e.prototype.GetAlbumById=function(e){for(var t=0,o=this.Albums();t<o.length;t++){var r=o[t];if(r.Id()===e)return r}throw"No Album with id "+e+" found"},e.prototype.GetTackById=function(e){for(var t=0,o=this.Tacks();t<o.length;t++){var r=o[t];if(r.Id()===e)return r}throw"No Tack with id "+e+" found"},e.prototype.GetLocationById=function(e){for(var t=0,o=this.Locations();t<o.length;t++){var r=o[t];if(r.Id()===e)return r}for(var n=0,i=this.Restaurants();n<i.length;n++){var r=i[n];if(r.Id()===e)return r}for(var a=0,s=this.Restaurants();a<s.length;a++){var r=s[a];if(r.Id()===e)return r}throw"No Location with id "+e+" found"},e}(),mapViewModel=new MapViewModel;ko.applyBindings(mapViewModel);
//# sourceMappingURL=site.min.js.map

var __extends=this&&this.__extends||function(e,t){function o(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)},ClientModel;!function(e){var t=function(){function e(){var t=this;this.AlbumId=ko.observable(),this.CommentListId=ko.observable(),this.Album=CreateObservable({ForeignKey:function(e){return e.AlbumId}}),this.InsertDate=ko.observable(Date),this.UpdateDate=ko.observable(Date),this.ClientId=e.clientIdCounter++,this.ServerApi=ServerApi.GetApi(this),this.savedStates=new Array,this.SaveState=function(o){void 0===o&&(o=new Array);var r=new Object;if(-1===o.indexOf(t)){o.push(t);for(var n=0,i=t.GetObservableNames();n<i.length;n++){var s=i[n],a=ko.unwrap(t[s]);if(a instanceof Array){a=a.slice(0);for(var h=0,l=a;h<l.length;h++){var p=l[h];p instanceof e&&p.SaveState(o)}}else a instanceof e&&a.SaveState(o);r[s]=a}t.savedStates.push(r)}},this.RevertState=function(o,r){if(void 0===o&&(o=!1),void 0===r&&(r=new Array),-1===r.indexOf(t)){if(r.push(t),0===t.savedStates.length){if(o)return;throw"No saved state"}for(var n=0,i=t.GetObservableNames();n<i.length;n++){var s=i[n],a=t.savedStates[0][s];if(t[s](a),a instanceof e)a.RevertState(o,r);else if(a instanceof Array)for(var h=0,l=a;h<l.length;h++){var p=l[h];p instanceof e&&p.RevertState(o,r)}}t.savedStates.shift()}},this.Id=ko.observable(),e.entityDb[this.ClientId.toString()]=this}return e.prototype.DeleteOnServer=function(){var e=this;return this.ServerApi.Delete(this.Id()).done(function(){e.removeFromContext()})},e.prototype.SaveToServer=function(){var e=this;return void 0===this.Id()?this.ServerApi.Create(this.ConvertToServerEntity()).done(function(t){e.savedStates=[],e.LoadFromServerEntity(t),e.addToContext()}):this.ServerApi.Update(this.ConvertToServerEntity()).done(function(t){e.savedStates=[],e.LoadFromServerEntity(t)})},e.prototype.LoadNavigationProperties=function(){for(var e in this.GetObservableNames())var t=this[e]},e.prototype.addToContext=function(){-1===this.Context().indexOf(this)&&this.Context().push(this)},e.prototype.removeFromContext=function(){this.Context().remove(this)},e.prototype.LoadFromServerEntity=function(t){if(t.ProcessOnServer===!1)return this;for(var o=0,r=this.GetObservableNames();o<r.length;o++){var n=r[o],i=t[n];if(void 0!==i&&null!==i)if(i instanceof Array)for(var s=0,a=i;s<a.length;s++){var h=a[s],l=e.entityDb[h.ClientId.toString()];void 0!==l&&l.LoadFromServerEntity(h)}else{var p=this[n]();p instanceof e?p.LoadFromServerEntity(i):this[n](i)}}return this},e.prototype.ConvertToServerEntity=function(t){if(void 0===t&&(t=!1),t)return{Id:this.Id(),ProcessOnServer:!1};for(var o=void 0!==this.Id(),r={ClientId:this.ClientId},n=this,i=0,s=this.GetObservableNames();i<s.length;i++){var a=s[i],h=n[a],l=h();if(void 0!==l)if(l instanceof Array){for(var p=new Array,u=0,v=l;u<v.length;u++){var d=v[u];(void 0===d.Id()||o&&h.UpdateTransferMode===TransferMode.Include||!o&&h.AddTransferMode===TransferMode.Include)&&p.push(d.ConvertToServerEntity())}r[a]=p}else r[a]=l instanceof e?void 0===l.Id()||o&&h.UpdateTransferMode===TransferMode.Include||!o&&h.AddTransferMode===TransferMode.Include?l.ConvertToServerEntity():void 0:l}return r},e.prototype.CopyTo=function(e){e.Id(this.Id())},e.prototype.GetObservableNames=function(){var e=new Array,t=this;for(var o in t)t.hasOwnProperty(o)&&ko.isWriteableObservable(t[o])&&!t[o].Block&&e.push(o);return e},e.prototype.OnSaving=function(){return!0},e.prototype.OnSaved=function(){return!0},e.prototype.OnDeleted=function(){return!0},e.clientIdCounter=0,e.entityDb={},e}();e.Entity=t;var o=function(e){function t(){e.apply(this,arguments),this.Images=ko.observableArray()}return __extends(t,e),t.prototype.Context=function(){return mapViewModel.Albums},t}(t);e.Album=o;var r=function(e){function t(){var t=this;e.apply(this,arguments),this.LastName=ko.observable(),this.FirstName=ko.observable(),this.FullName=ko.computed(function(){return t.FirstName()+" "+t.LastName()})}return __extends(t,e),t.prototype.Context=function(){return mapViewModel.Persons},t}(t);e.Person=r;var n=function(e){function t(){e.apply(this,arguments),this.DueTo=ko.observable(Date),this.AssignedTo=ko.observable(),this.AssignedToId=ko.observable(),this.Title=ko.observable(),this.Content=ko.observable(),this.Done=ko.observable(),this.SuperJob=ko.observable(),this.SuperJobId=ko.observable(),this.Trip=ko.observable(),this.TripId=ko.observable(),this.SubJobs=ko.observableArray()}return __extends(t,e),t.prototype.Context=function(){return mapViewModel.Jobs},t}(t);e.Job=n;var i=function(e){function t(t,o,r){var n=this;e.call(this),this.Map=r,this.WaypointNumber=ko.observable(),this.polylines=new Array,this.Latitude=ko.observable(0),this.Longitude=ko.observable(0),this.Distance=ko.observable(),this.Precessor=ko.observable(),this.RouteDistance=ko.observable(),this.RoutePrecessor=ko.observable(),this.Name=ko.observable(),this.Description=ko.observable(),this.Wifis=ko.observableArray(),void 0===r?("number"==typeof o&&(r=t,t=o,o=r),this.Map=o,this.LatLng=new L.LatLng(0,0),o=t):(this.Latitude(t.lat),this.Longitude(t.lng)),this.LatLng=new L.LatLng(this.Latitude(),this.Longitude()),this.Latitude.subscribe(function(e){n.LatLng.lat!==e&&(n.LatLng.lat=e,n.Redraw())}),this.Longitude.subscribe(function(e){n.LatLng.lng!==e&&(n.LatLng.lng=e,n.Redraw())}),this.markerType=o,this.LatLng.Polylines=new Array,this.LatLng.Waypoint=this,this.Precessor.Block=!0,this.Distance.Block=!0}return __extends(t,e),t.prototype.Popup=function(e){void 0!==this.popup&&(this.Map.removeLayer(this.popup),this.popup=void 0),void 0!==e&&this.marker.bindPopup(e)},t.prototype.Show=function(e){void 0===e&&(e=!1),this.marker.setOpacity(this.marker.Waypoint.IsDummy()?.5:1),e&&$(this.marker._icon).addClass("expose")},t.prototype.Hide=function(){this.marker.setOpacity(.1),$(this.marker._icon).removeClass("expose")},t.prototype.Redraw=function(e){if(void 0===e&&(e=!0),void 0!==this.marker&&this.marker.setLatLng(this.LatLng),e)for(var t=0;t<this.polylines.length;t++)redrawPolyline(this.polylines[t])},t.prototype.GetConnectedWaypoints=function(){for(var e=this,t=new Array,o=0,r=this.polylines;o<r.length;o++)for(var n=r[o],i=0,s=n.Waypoints;i<s.length;i++){var a=s[i];a!==this&&t.push(a)}return t.sort(function(t,o){return t.LatLng.distanceTo(e.LatLng)-o.LatLng.distanceTo(e.LatLng)})},t.prototype.convertFromDummyHandle=function(){if(this.markerType===MarkerType.Dummy){this.marker.setOpacity(1);var e=this.polylines[0].Waypoints[0],t=this.polylines[0].Waypoints[1];this.markerType=MarkerType.Waypoint,splitPolyline(this.polylines[0]),this.SaveToServer().done(function(o){var r=ServerApi.WaypointConnections;r.Disconnect(e.Id(),t.Id()),r.Connect(e.Id(),o.Id),r.Connect(t.Id(),o.Id)})}},t.prototype.IsInPolyline=function(e){for(var t=0,o=e.Waypoints;t<o.length;t++){var r=o[t];if(this===r)return!0}return!1},t.prototype.RemoveFromMap=function(){if(this.markerType!==MarkerType.Dummy)for(var e=0,t=this.polylines;e<t.length;e++){var o=t[e];removePolyline(o)}this.Map.removeLayer(this.marker)},t.prototype.AddToPolyline=function(e){return this.IsInPolyline(e)?!1:(this.IsDummy()||e.DummyHandle===this||(e.Waypoints.push(this),e.addLatLng(this.LatLng),e.redraw()),this.polylines[0]!==e&&(this.LatLng.Polylines.push(e),this.polylines.push(e)),!0)},t.prototype.RemoveFromPolyline=function(e){return removeFromArray(e.Waypoints,this),removeFromArray(this.polylines,e),removeFromArray(this.LatLng.Polylines,e),removeFromArray(e.getLatLngs(),this.LatLng),e.redraw(),!0},t.prototype.RemoveIfHasZeroOrOnePolylines=function(){return!0},t.prototype.SetLatLng=function(e,t){void 0===t&&(t=!0),this.LatLng.lat=e.lat,this.LatLng.lng=e.lng,this.Latitude(e.lat),this.Longitude(e.lng),this.Redraw(t)},t.prototype.CenterOnMap=function(){this.Map.setView(this.LatLng)},t.prototype.IsDummy=function(){return this.markerType===MarkerType.Dummy},t.prototype.Context=function(){return mapViewModel.Waypoints},t.prototype.DeleteOnServer=function(){var t=this;return e.prototype.DeleteOnServer.call(this).done(function(){return t.RemoveFromMap()})},t}(t);e.Waypoint=i;var s=function(e){function t(t,r){var n=this;e.call(this,t,MarkerType.Harbour,r),this.Album=ko.observable(new o),this.Locations=ko.observableArray(),this.Rating=ko.observable(),this.Content=ko.observable(),this.Website=ko.observable(),this.Name.subscribe(function(e){if(void 0!==n.marker){var t=n.marker.getLabel();void 0!==t?n.marker.updateLabelContent(e):n.marker.bindLabel(e,{direction:"auto"})}})}return __extends(t,e),t.prototype.RemoveIfHasZeroOrOnePolylines=function(){return!1},t.prototype.Context=function(){return mapViewModel.Harbours},t}(i);e.Harbour=s;var a=function(e){function t(){e.apply(this,arguments),this.Street=ko.observable(),this.Zip=ko.observable(),this.Town=ko.observable(),this.Comment=ko.observable()}return __extends(t,e),t.prototype.Context=function(){return mapViewModel.Addresses},t}(t);e.Address=a;var h=function(e){function t(){e.apply(this,arguments),this.Path=ko.observable(),this.Height=ko.observable(),this.Width=ko.observable()}return __extends(t,e),t.prototype.Context=function(){return mapViewModel.Images},t}(t);e.Image=h;var l=function(e){function t(){var t=this;e.apply(this,arguments),this.StartDate=ko.observable(),this.EndDate=ko.observable(),this.Start=ko.observable(),this.StartId=ko.observable(),this.EndId=ko.observable(),this.End=ko.observable(),this.Persons=ko.observableArray(),this.Distance=ko.observable(0),this.Album=ko.observable(new o),this.CrewList=ko.computed({read:function(){var e=t.Persons(),o=e[0];if(void 0===o)return"";if(1===e.length)return o.FullName();for(var r=o.FullName(),n=1;n<e.length;n++)r+=", "+e[n].FullName();return r},deferEvaluation:!0}),this.SaillingTime=ko.computed(function(){var e=t.StartDate(),o=t.EndDate();return void 0===e||void 0===o||void 0===renderTime?"":renderTime(new Date(e),new Date(o))})}return __extends(t,e),t.prototype.ConvertToServerEntity=function(t){this.EndId(this.End().Id()),this.StartId(this.Start().Id());for(var o=e.prototype.ConvertToServerEntity.call(this,t),r=new Array,n=0,i=this.Persons();n<i.length;n++){var s=i[n];r.push({PersonId:s.Id(),TackId:this.Id()})}return o.Crew=r,o},t}(t);e.TackBase=l;var p=function(e){function t(){e.apply(this,arguments),this.Name=ko.observable(),this.Content=ko.observable(),this.Tacks=ko.observableArray(),this.IsDummy=ko.observable()}return __extends(t,e),t.prototype.Context=function(){return mapViewModel.Trips},t}(l);e.Trip=p;var u=function(e){function t(){e.apply(this,arguments),this.MotorHoursStart=ko.observable(),this.MotorHoursEnd=ko.observable(),this.LogStart=ko.observable(),this.LogEnd=ko.observable(),this.WindSpeed=ko.observable(),this.WindDirection=ko.observable(),this.SpecialOccurences=ko.observable()}return __extends(t,e),t.prototype.Context=function(){return mapViewModel.LogBookEntries},t}(l);e.LogBookEntry=u;var v=function(e){function t(){var t=this;e.apply(this,arguments),this.Waypoints=ko.observableArray(),this.CanRemoveTack=ko.computed({read:function(){if(void 0===mapViewModel.TripHelper.Editing())return!1;var e=mapViewModel.TripHelper.Editing().Tacks,o=e.indexOf(t),r=e()[o-1],n=e()[o+1];return void 0!==r?void 0!==n?r.Start()!==n.Start():!0:void 0!==n},deferEvaluation:!0}),this.ComputePlaceholder=ko.computed(function(){return void 0!==t.StartDate()?moment(t.StartDate()).format("L"):""})}return __extends(t,e),t.prototype.Context=function(){return mapViewModel.Tacks},t}(l);e.Tack=v;var d=function(e){function t(){e.apply(this,arguments),this.Title=ko.observable(),this.Content=ko.observable(),this.Rating=ko.observable(),this.ParentId=ko.observable()}return __extends(t,e),t.prototype.Context=function(){throw"not implemented"},t}(t);e.Comment=d;var b=function(e){function t(){e.apply(this,arguments),this.HarbourId=ko.observable(),this.Website=ko.observable(),this.Name=ko.observable(),this.Rating=ko.observable(),this.Address=ko.observable(),this.AddressId=ko.observable()}return __extends(t,e),t.prototype.Context=function(){return mapViewModel.Locations},t}(t);e.Location=b;var c=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t}(b);e.Restaurant=c;var y=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t}(b);e.Supermarket=y;var f=function(){function e(e,t,o,r,n){this.Precessor=e,this.Waypoint=t,this.Distance=o,this.ConnectedWayPoints=new Array,this.ConnectedDistances=new Array,this.LatLng=t.LatLng,r.push(t);for(var i=0,s=t.GetConnectedWaypoints();i<s.length;i++){var a=s[i];-1===r.indexOf(a)&&this.ConnectedWayPoints.push(a)}n?(t.RoutePrecessor(e),t.RouteDistance(o)):(t.Precessor(e),t.Distance(o))}return e}();e.WaypointDistance=f;var m=function(e){function t(){e.apply(this,arguments),this.Name=ko.observable(),this.Password=ko.observable(),this.Speed=ko.observable(),this.Free=ko.observable(),this.HarbourId=ko.observable(),this.Harbour=ko.observable()}return __extends(t,e),t.prototype.Context=function(){return mapViewModel.Wifis},t}(t);e.Wifi=m;var k=function(e){function t(){e.apply(this,arguments),this.Title=ko.observable(),this.Content=ko.observable()}return __extends(t,e),t.prototype.Context=function(){return mapViewModel.ContentPages},t}(t);e.ContentPage=k}(ClientModel||(ClientModel={}));var MarkerType;!function(e){e[e.Harbour=0]="Harbour",e[e.Dummy=1]="Dummy",e[e.Waypoint=2]="Waypoint",e[e.WeatherStation=3]="WeatherStation"}(MarkerType||(MarkerType={}));
//# sourceMappingURL=ClientModel.min.js.map

var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},ClientModel;!function(e){var t=ServerModel.Person,r=ServerModel.Address,o=ServerModel.Album,i=ServerModel.CommentList,n=function(){function e(){this.Id=ko.observable(),this.AlbumId=ko.observable(),this.CommentListId=ko.observable(),this.Album=CreateObservable({AddTransferMode:TransferMode.Include,UpdateTransferMode:TransferMode.Include}),this.CommentList=ko.observable(),this.ClientId=++e.ClientIdCounter,e.EntityDB[this.ClientId.toString()]=this}return e.prototype.DeleteOnServer=function(){return this.ServerApi.Delete(this.Id())},e.prototype.SaveToServer=function(){var e=this;return void 0===this.Id()?this.ServerApi.Create(this.ConvertToServerEntity()).done(function(t){e.savedState=void 0,e.LoadFromServerEntity(t)}):this.ServerApi.Update(this.ConvertToServerEntity()).done(function(t){e.savedState=void 0,e.LoadFromServerEntity(t)})},e.prototype.LoadFromServerEntity=function(t){for(var r=0,o=this.GetObservableNames();r<o.length;r++){var i=o[r],n=t[i];if(void 0!==n&&null!==n)if(n instanceof Array)for(var a=0,s=n;a<s.length;a++){var v=s[a],p=e.EntityDB[v.ClientId.toString()];void 0!==p&&p.LoadFromServerEntity(v)}else{var l=this[i]();l instanceof e?l.LoadFromServerEntity(n):this[i](n)}}return this},e.prototype.ConvertToServerEntity=function(t){void 0===t&&(t=!1);for(var r={ClientId:this.ClientId},o=this,i=0,n=this.GetObservableNames();i<n.length;i++){var a=n[i],s=o[a],v=s();if(void 0!==v)if(v instanceof Array){for(var p=new Array,l=0,h=v;l<h.length;l++){var u=h[l];p.push(u.ConvertToServerEntity())}r[a]=p}else r[a]=v instanceof e?v.ConvertToServerEntity():v}return r},e.prototype.CopyTo=function(e){e.Id(this.Id())},e.prototype.SaveState=function(){var t=this;t.savedState=new Object;for(var r=0,o=this.GetObservableNames();r<o.length;r++){var i=o[r],n=ko.unwrap(t[i]);if(n instanceof Array){n=n.slice(0);for(var a=0,s=n;a<s.length;a++){var v=s[a];v instanceof e&&v.SaveState()}}else n instanceof e&&n.SaveState();t.savedState[i]=n}},e.prototype.GetObservableNames=function(){var e=new Array,t=this;for(var r in t)t.hasOwnProperty(r)&&ko.isWriteableObservable(t[r])&&!t[r].Block&&e.push(r);return e},e.prototype.RevertState=function(t){if(void 0===t&&(t=!1),void 0===this.savedState){if(t)return;throw"No saved state"}for(var r=this,o=0,i=this.GetObservableNames();o<i.length;o++){var n=i[o],a=r.savedState[n];if(r[n](a),a instanceof e)a.RevertState();else if(a instanceof Array)for(var s=0,v=a;s<v.length;s++){var p=v[s];p instanceof e&&p.RevertState()}}},e.ClientIdCounter=0,e.EntityDB={},e}();e.Entity=n;var a=function(e){function t(){e.apply(this,arguments),this.Images=ko.observableArray(),this.ServerApi=ServerApi.AlbumApi.GetDefault()}return __extends(t,e),t.prototype.CreateServerEntity=function(){return new o},t}(n);e.Album=a;var s=function(){function e(){}return e}();e.AlbumImage=s;var v=function(e){function t(){e.apply(this,arguments),this.ServerApi=ServerApi.CommentListApi.GetDefault()}return __extends(t,e),t.prototype.CreateServerEntity=function(){return new i},t}(n);e.CommentList=v;var p=function(e){function r(){var t=this;e.apply(this,arguments),this.ServerApi=ServerApi.PersonApi.GetDefault(),this.LastName=ko.observable(),this.FirstName=ko.observable(),this.FullName=ko.computed(function(){return t.FirstName()+" "+t.LastName()})}return __extends(r,e),r.prototype.CreateServerEntity=function(){return new t},r}(n);e.Person=p;var l=function(e){function t(){e.apply(this,arguments),this.DueTo=ko.observable(),this.AssignedTo=ko.observable(),this.AssignedToId=ko.observable(),this.Title=ko.observable(),this.Content=ko.observable(),this.Done=ko.observable(),this.SuperJob=ko.observable(),this.SuperJobId=ko.observable(),this.Trip=ko.observable(),this.TripId=ko.observable(),this.SubJobs=ko.observableArray(),this.ServerApi=ServerApi.JobApi.GetDefault()}return __extends(t,e),t.prototype.CreateServerEntity=function(){return new ServerModel.Job},t}(n);e.Job=l;var h=function(e){function t(t,r,o){var i=this;e.call(this),this.Map=o,this.WaypointNumber=ko.observable(),this.polylines=new Array,this.Latitude=ko.observable(),this.Longitude=ko.observable(),this.Distance=ko.observable(),this.Precessor=ko.observable(),this.RouteDistance=ko.observable(),this.RoutePrecessor=ko.observable(),this.Name=ko.observable(),this.Description=ko.observable(),this.ServerApi=ServerApi.WaypointApi.GetDefault(),this.Latitude(t.lat),this.Longitude(t.lng),this.LatLng=new L.LatLng(t.lat,t.lng),this.Latitude.subscribe(function(e){i.LatLng.lat!==e&&(i.LatLng.lat=e,i.Redraw())}),this.Longitude.subscribe(function(e){i.LatLng.lng!==e&&(i.LatLng.lng=e,i.Redraw())}),this.markerType=r,this.LatLng.Polylines=new Array,this.LatLng.Waypoint=this,this.Precessor.Block=!0,this.Distance.Block=!0}return __extends(t,e),t.prototype.Popup=function(e){void 0!==this.popup&&(this.Map.removeLayer(this.popup),this.popup=void 0),void 0!==e&&this.marker.bindPopup(e)},t.prototype.Show=function(e){void 0===e&&(e=!1),this.marker.setOpacity(this.marker.Waypoint.IsDummy()?.5:1),e&&$(this.marker._icon).addClass("expose")},t.prototype.Hide=function(){this.marker.setOpacity(.1),$(this.marker._icon).removeClass("expose")},t.prototype.Redraw=function(e){if(void 0===e&&(e=!0),this.marker.setLatLng(this.LatLng),e)for(var t=0;t<this.polylines.length;t++)redrawPolyline(this.polylines[t])},t.prototype.GetConnectedWaypoints=function(){for(var e=this,t=new Array,r=0,o=this.polylines;r<o.length;r++)for(var i=o[r],n=0,a=i.Waypoints;n<a.length;n++){var s=a[n];s!==this&&t.push(s)}return t.sort(function(t,r){return t.LatLng.distanceTo(e.LatLng)-r.LatLng.distanceTo(e.LatLng)})},t.prototype.convertFromDummyHandle=function(){this.marker.setOpacity(1);var e=this.polylines[0].Waypoints[0],t=this.polylines[0].Waypoints[1];splitPolyline(this.polylines[0]),this.markerType=MarkerType.Waypoint,this.SaveToServer().done(function(r){var o=ServerApi.WaypointConnectionApi.GetDefault();o.Disconnect(e.Id(),t.Id()),o.Connect(e.Id(),r.Id),o.Connect(t.Id(),r.Id)})},t.prototype.IsInPolyline=function(e){for(var t=0,r=this.polylines;t<r.length;t++){var o=r[t];if(e===o)return!0}return!1},t.prototype.RemoveFromMap=function(){if(this.markerType!==MarkerType.Dummy)for(var e=0,t=this.polylines;e<t.length;e++){var r=t[e];removePolyline(r)}this.Map.removeLayer(this.marker)},t.prototype.AddToPolyline=function(e){return this.IsInPolyline(e)?!1:(e.DummyHandle!==this&&(e.Waypoints.push(this),e.addLatLng(this.LatLng),e.redraw()),this.LatLng.Polylines.push(e),this.polylines.push(e),!0)},t.prototype.RemoveFromPolyline=function(e){return this.IsInPolyline(e)?(removeFromArray(e.Waypoints,this),removeFromArray(this.polylines,e),removeFromArray(this.LatLng.Polylines,e),removeFromArray(e.getLatLngs(),this.LatLng),e.redraw(),!0):!1},t.prototype.RemoveIfHasZeroOrOnePolylines=function(){return!0},t.prototype.SetLatLng=function(e,t){void 0===t&&(t=!0),this.LatLng.lat=e.lat,this.LatLng.lng=e.lng,this.Latitude(e.lat),this.Longitude(e.lng),this.Redraw(t)},t.prototype.CenterOnMap=function(){this.Map.setView(this.LatLng)},t.prototype.IsDummy=function(){return this.markerType===MarkerType.Dummy},t.prototype.CreateServerEntity=function(){return new ServerModel.Waypoint},t}(n);e.Waypoint=h;var u=function(e){function t(t,r,o){var i=this;e.call(this,r,MarkerType.Harbour,o),this.Album=ko.observable(new a),this.CommentList=ko.observable(new v),this.ServerApi=ServerApi.HarbourApi.GetDefault(),this.Locations=ko.observableArray(),this.Rating=ko.observable(),this.Content=ko.observable(),this.Website=ko.observable(),this.Name(t),this.Name.subscribe(function(e){var t=i.marker.getLabel();void 0!==t?i.marker.updateLabelContent(e):i.marker.bindLabel(e,{direction:"auto"})})}return __extends(t,e),t.prototype.RemoveIfHasZeroOrOnePolylines=function(){return!1},t.prototype.CreateServerEntity=function(){return new ServerModel.Harbour},t}(h);e.Harbour=u;var y=function(e){function t(){e.apply(this,arguments),this.Name=ko.observable(),this.Start=ko.observable(),this.End=ko.observable(),this.Content=ko.observable(),this.Tacks=ko.observableArray(),this.ServerApi=ServerApi.TripApi.GetDefault()}return __extends(t,e),t.prototype.CreateServerEntity=function(){return new ServerModel.Trip},t}(n);e.Trip=y;var b=function(e){function t(){e.apply(this,arguments),this.Street=ko.observable(),this.Zip=ko.observable(),this.Town=ko.observable(),this.Comment=ko.observable(),this.ServerApi=ServerApi.AddressApi.GetDefault()}return __extends(t,e),t.prototype.CreateServerEntity=function(){return new r},t}(n);e.Address=b;var d=function(e){function t(){e.apply(this,arguments),this.Path=ko.observable(),this.Height=ko.observable(),this.Width=ko.observable(),this.ServerApi=ServerApi.ImageApi.GetDefault()}return __extends(t,e),t.prototype.CreateServerEntity=function(){return new ServerModel.Image},t}(n);e.Image=d;var c=function(e){function t(){var t=this;e.apply(this,arguments),this.StartDate=ko.observable(),this.EndDate=ko.observable(),this.Start=ko.observable(),this.End=ko.observable(),this.Waypoints=ko.observableArray(),this.Crew=ko.observableArray(),this.Distance=ko.observable(),this.ServerApi=ServerApi.TackApi.GetDefault(),this.CanRemoveTack=ko.computed({read:function(){if(void 0===mapViewModel.SelectedTrip())return!1;var e=mapViewModel.SelectedTrip().Tacks,r=e.indexOf(t),o=e()[r-1],i=e()[r+1];return void 0!==o?void 0!==i?o.Start()!==i.Start():!0:void 0!==i},deferEvaluation:!0}),this.ComputePlaceholder=ko.computed(function(){return void 0!==t.StartDate()?moment(t.StartDate()).format("L"):""})}return __extends(t,e),t.prototype.CreateServerEntity=function(){return new ServerModel.Tack},t}(n);e.Tack=c;var f=function(e){function t(){e.apply(this,arguments),this.HarbourId=ko.observable(),this.Website=ko.observable(),this.Name=ko.observable(),this.Rating=ko.observable(),this.Address=ko.observable(),this.AddressId=ko.observable(),this.ServerApi=ServerApi.LocationApi.GetDefault()}return __extends(t,e),t.prototype.CreateServerEntity=function(){return new ServerModel.Location},t}(n);e.Location=f;var m=function(e){function t(){e.apply(this,arguments),this.ServerApi=ServerApi.RestaurantApi.GetDefault()}return __extends(t,e),t.prototype.CreateServerEntity=function(){return new ServerModel.Restaurant},t}(f);e.Restaurant=m;var S=function(e){function t(){e.apply(this,arguments),this.ServerApi=ServerApi.SupermarketApi.GetDefault()}return __extends(t,e),t.prototype.CreateServerEntity=function(){return new ServerModel.Supermarket},t}(f);e.Supermarket=S;var k=function(){function e(e,t,r,o,i){this.Precessor=e,this.Waypoint=t,this.Distance=r,this.ConnectedWayPoints=new Array,this.ConnectedDistances=new Array,this.LatLng=t.LatLng,o.push(t);for(var n=0,a=t.GetConnectedWaypoints();n<a.length;n++){var s=a[n];-1===o.indexOf(s)&&this.ConnectedWayPoints.push(s)}i?(t.RoutePrecessor(e),t.RouteDistance(r)):(t.Precessor(e),t.Distance(r))}return e}();e.WaypointDistance=k}(ClientModel||(ClientModel={}));var MarkerType;!function(e){e[e.Harbour=0]="Harbour",e[e.Dummy=1]="Dummy",e[e.Waypoint=2]="Waypoint",e[e.WeatherStation=3]="WeatherStation"}(MarkerType||(MarkerType={}));
//# sourceMappingURL=ClientModel.min.js.map
